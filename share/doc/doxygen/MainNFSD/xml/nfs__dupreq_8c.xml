<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.5.7.1">
  <compounddef id="nfs__dupreq_8c" kind="file">
    <compoundname>nfs_dupreq.c</compoundname>
    <includes local="no">stdio.h</includes>
    <includes local="no">sys/types.h</includes>
    <includes local="no">ctype.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">dirent.h</includes>
    <includes local="no">netdb.h</includes>
    <includes local="no">netinet/in.h</includes>
    <includes local="no">arpa/inet.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">pthread.h</includes>
    <includes local="no">fcntl.h</includes>
    <includes local="no">sys/file.h</includes>
    <includes local="no">pwd.h</includes>
    <includes local="no">grp.h</includes>
    <includes local="no">rpc/rpc.h</includes>
    <includes local="no">rpc/svc.h</includes>
    <includes local="no">rpc/pmap_clnt.h</includes>
    <includes local="yes">LRU_List.h</includes>
    <includes local="yes">HashData.h</includes>
    <includes local="yes">HashTable.h</includes>
    <includes local="yes">log_functions.h</includes>
    <includes local="yes">nfs_core.h</includes>
    <includes local="yes">nfs23.h</includes>
    <includes local="yes">nfs4.h</includes>
    <includes local="yes">fsal.h</includes>
    <includes local="yes">stuff_alloc.h</includes>
    <includes local="yes">nfs_tools.h</includes>
    <includes local="yes">nfs_exports.h</includes>
    <includes local="yes">nfs_file_handle.h</includes>
    <includes local="yes">nfs_dupreq.h</includes>
    <incdepgraph>
      <node id="50">
        <label>grp.h</label>
      </node>
      <node id="43">
        <label>netinet/in.h</label>
      </node>
      <node id="44">
        <label>arpa/inet.h</label>
      </node>
      <node id="53">
        <label>rpc/pmap_clnt.h</label>
      </node>
      <node id="54">
        <label>LRU_List.h</label>
      </node>
      <node id="61">
        <label>fsal.h</label>
      </node>
      <node id="40">
        <label>stdlib.h</label>
      </node>
      <node id="47">
        <label>fcntl.h</label>
      </node>
      <node id="52">
        <label>rpc/svc.h</label>
      </node>
      <node id="42">
        <label>netdb.h</label>
      </node>
      <node id="57">
        <label>log_functions.h</label>
      </node>
      <node id="60">
        <label>nfs4.h</label>
      </node>
      <node id="46">
        <label>pthread.h</label>
      </node>
      <node id="38">
        <label>sys/types.h</label>
      </node>
      <node id="45">
        <label>string.h</label>
      </node>
      <node id="56">
        <label>HashTable.h</label>
      </node>
      <node id="48">
        <label>sys/file.h</label>
      </node>
      <node id="51">
        <label>rpc/rpc.h</label>
      </node>
      <node id="64">
        <label>nfs_exports.h</label>
      </node>
      <node id="58">
        <label>nfs_core.h</label>
      </node>
      <node id="59">
        <label>nfs23.h</label>
      </node>
      <node id="39">
        <label>ctype.h</label>
      </node>
      <node id="49">
        <label>pwd.h</label>
      </node>
      <node id="62">
        <label>stuff_alloc.h</label>
      </node>
      <node id="36">
        <label>nfs_dupreq.c</label>
        <link refid="nfs_dupreq.c"/>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>stdio.h</label>
      </node>
      <node id="55">
        <label>HashData.h</label>
      </node>
      <node id="65">
        <label>nfs_file_handle.h</label>
      </node>
      <node id="63">
        <label>nfs_tools.h</label>
      </node>
      <node id="66">
        <label>nfs_dupreq.h</label>
      </node>
      <node id="41">
        <label>dirent.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" prot="public" static="no" mutable="no">
        <type>nfs_parameter_t</type>
        <definition>nfs_parameter_t nfs_param</definition>
        <argsstring></argsstring>
        <name>nfs_param</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="132" bodyfile="/export/GANESHA/src/MainNFSD/nfs_init.c" bodystart="135" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_1d1973964670037b91a33fd6b6e4c40bc" prot="public" static="no" mutable="no">
        <type>nfs_function_desc_t</type>
        <definition>nfs_function_desc_t nfs2_func_desc[]</definition>
        <argsstring>[]</argsstring>
        <name>nfs2_func_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="133" bodyfile="/export/GANESHA/src/MainNFSD/nfs_worker_thread.c" bodystart="169" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_1177ddde86497df151d3b3ff5c876d90a" prot="public" static="no" mutable="no">
        <type>nfs_function_desc_t</type>
        <definition>nfs_function_desc_t nfs3_func_desc[]</definition>
        <argsstring>[]</argsstring>
        <name>nfs3_func_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="134" bodyfile="/export/GANESHA/src/MainNFSD/nfs_worker_thread.c" bodystart="191" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_1de3381a451007489495bf0b92585520f" prot="public" static="no" mutable="no">
        <type>nfs_function_desc_t</type>
        <definition>nfs_function_desc_t nfs4_func_desc[]</definition>
        <argsstring>[]</argsstring>
        <name>nfs4_func_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="135" bodyfile="/export/GANESHA/src/MainNFSD/nfs_worker_thread.c" bodystart="218" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_1331b43564c209696c670c70673d544e1" prot="public" static="no" mutable="no">
        <type>nfs_function_desc_t</type>
        <definition>nfs_function_desc_t mnt1_func_desc[]</definition>
        <argsstring>[]</argsstring>
        <name>mnt1_func_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="136" bodyfile="/export/GANESHA/src/MainNFSD/nfs_worker_thread.c" bodystart="224" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_17bcfef9b974d9b55a0f057d959a13bb8" prot="public" static="no" mutable="no">
        <type>nfs_function_desc_t</type>
        <definition>nfs_function_desc_t mnt3_func_desc[]</definition>
        <argsstring>[]</argsstring>
        <name>mnt3_func_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="137" bodyfile="/export/GANESHA/src/MainNFSD/nfs_worker_thread.c" bodystart="234" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" prot="public" static="no" mutable="no">
        <type>hash_table_t *</type>
        <definition>hash_table_t* ht_dupreq</definition>
        <argsstring></argsstring>
        <name>ht_dupreq</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="140" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="140" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="nfs__dupreq_8c_1e04d38ace0d9a143801c1625135d4ad7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned int</type>
        <definition>unsigned int get_rpc_xid</definition>
        <argsstring>(struct svc_req *reqp)</argsstring>
        <name>get_rpc_xid</name>
        <param>
          <type>struct svc_req *</type>
          <declname>reqp</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>get_rpc_xid: extract the transfer Id from a RPC request.</para><para>RPC Xid is used for RPC Reply cache. With UDP connection, the xid is in an opaque structure stored in xprt-&gt;xp_p2, but with TCP connection, the xid is in another opaque structure stored in xprt-&gt;xp_p1. xp_p2 and xp_p1 are mutually exclusive. The opaque structure are well defined in ONC RPC protocol definitions, and used internally by the ONC layers. Since I need to know the xid the structures are defined here.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>reqp</parametername>
</parameternamelist>
<parameterdescription>
<para>A pointer to the request to be examined.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the found xid. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="159" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="158" bodyend="193"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_1f812dda060fd0aa4f965adadb15dd22d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int print_entry_dupreq</definition>
        <argsstring>(LRU_data_t data, char *str)</argsstring>
        <name>print_entry_dupreq</name>
        <param>
          <type>LRU_data_t</type>
          <declname>data</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>str</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>print_entry_dupreq: prints an entry in the LRU list.</para><para>prints an entry in the LRU list.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] data stored in a LRU entry to be printed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>str</parametername>
</parameternamelist>
<parameterdescription>
<para>[OUT] string used to store the result.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if ok, other values mean an error. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="209" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="208" bodyend="212"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_10dd9a264f91e9823e807b34e6994f777" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int clean_entry_dupreq</definition>
        <argsstring>(LRU_entry_t *pentry, void *addparam)</argsstring>
        <name>clean_entry_dupreq</name>
        <param>
          <type>LRU_entry_t *</type>
          <declname>pentry</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>addparam</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>clean_entry_dupreq: cleans an entry in the dupreq cache.</para><para>cleans an entry in the dupreq cache.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pentry</parametername>
</parameternamelist>
<parameterdescription>
<para>[INOUT] entry to be cleaned. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>addparam</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] additional parameter used for cleaning.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if ok, other values mean an error. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="228" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="227" bodyend="307"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_17363cd3531f6119e8a2047a57e51e08f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned long</type>
        <definition>unsigned long dupreq_value_hash_func</definition>
        <argsstring>(hash_parameter_t *p_hparam, hash_buffer_t *buffclef)</argsstring>
        <name>dupreq_value_hash_func</name>
        <param>
          <type>hash_parameter_t *</type>
          <declname>p_hparam</declname>
        </param>
        <param>
          <type>hash_buffer_t *</type>
          <declname>buffclef</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>dupreq_rbt_hash_func: computes the hash value for the entry in dupreq cache.</para><para>Computes the hash value for the entry in dupreq cache. In fact, it just use the Xid modulo the hash array size. This function is called internal in the HasTable_* function</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>hparam</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] hash table parameter. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buffcleff[in]</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to the hash key buffer</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the computed hash value.</para></simplesect>
<simplesect kind="see"><para>HashTable_Init </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="325" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="324" bodyend="327"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_1cd77080a96d71b76efbdee9178171504" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned long</type>
        <definition>unsigned long dupreq_rbt_hash_func</definition>
        <argsstring>(hash_parameter_t *p_hparam, hash_buffer_t *buffclef)</argsstring>
        <name>dupreq_rbt_hash_func</name>
        <param>
          <type>hash_parameter_t *</type>
          <declname>p_hparam</declname>
        </param>
        <param>
          <type>hash_buffer_t *</type>
          <declname>buffclef</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>dupreq_rbt_hash_func: computes the rbt value for the entry in dupreq cache.</para><para>Computes the rbt value for the entry in dupreq cache. In fact, it just use the Xid itself (which is an unsigned integer) as the rbt value. This function is called internal in the HasTable_* function</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>hparam</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] hash table parameter. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buffcleff[in]</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to the hash key buffer</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the computed rbt value.</para></simplesect>
<simplesect kind="see"><para>HashTable_Init </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="346" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="345" bodyend="349"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_11754ccd21821c745e816f32a7a459e24" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int compare_xid</definition>
        <argsstring>(hash_buffer_t *buff1, hash_buffer_t *buff2)</argsstring>
        <name>compare_xid</name>
        <param>
          <type>hash_buffer_t *</type>
          <declname>buff1</declname>
        </param>
        <param>
          <type>hash_buffer_t *</type>
          <declname>buff2</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>compare_xid: compares the xid stored in the key buffers.</para><para>compare the xid stored in the key buffers. This function is to be used as &apos;compare_key&apos; field in the hashtable storing the nfs duplicated requests.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>buff1</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] first key </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buff2</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] second key</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if keys are identifical, 1 if they are different. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="365" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="364" bodyend="369"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_130afd5b6d3dff5d4d7d4767089d59b44" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int display_xid</definition>
        <argsstring>(hash_buffer_t *pbuff, char *str)</argsstring>
        <name>display_xid</name>
        <param>
          <type>hash_buffer_t *</type>
          <declname>pbuff</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>str</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>display_xid: displays the xid stored in the buffer.</para><para>displays the xid stored in the buffer. This function is to be used as &apos;key_to_str&apos; field in the hashtable storing the nfs duplicated requests.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>buff1</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] buffer to display </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buff2</parametername>
</parameternamelist>
<parameterdescription>
<para>[OUT] output string</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>number of character written. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="385" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="384" bodyend="389"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_10e0c7a1fda2f7d756dd1b2f8b4f97db6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_Init_dupreq</definition>
        <argsstring>(nfs_rpc_dupreq_parameter_t param)</argsstring>
        <name>nfs_Init_dupreq</name>
        <param>
          <type>nfs_rpc_dupreq_parameter_t</type>
          <declname>param</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_Init_dupreq: Init the hashtable and LRU for duplicate request cache</para><para>Perform all the required initialization for hashtable and LRU for duplicate request cache</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] parameter used to init the duplicate request cache</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if successful, -1 otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="403" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="402" bodyend="411"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_172a8bca40613bd2e5a727a7274ca8e66" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_dupreq_add</definition>
        <argsstring>(long xid, struct svc_req *ptr_req, nfs_res_t *p_res_nfs, LRU_list_t *lru_dupreq, dupreq_entry_t **p_dupreq_pool)</argsstring>
        <name>nfs_dupreq_add</name>
        <param>
          <type>long</type>
          <declname>xid</declname>
        </param>
        <param>
          <type>struct svc_req *</type>
          <declname>ptr_req</declname>
        </param>
        <param>
          <type>nfs_res_t *</type>
          <declname>p_res_nfs</declname>
        </param>
        <param>
          <type>LRU_list_t *</type>
          <declname>lru_dupreq</declname>
        </param>
        <param>
          <type>dupreq_entry_t **</type>
          <declname>p_dupreq_pool</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_dupreq_add: adds an entry in the duplicate requests cache.</para><para>Adds an entry in the duplicate requests cache.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>xid</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] the transfer id to be used as key </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pnfsreq</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] the request pointer to cache</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>DUPREQ_SUCCESS if successfull<linebreak/>
. </para><para>DUPREQ_INSERT_MALLOC_ERROR if an error occured during the insertion process. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="433" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="428" bodyend="488"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_1f44969aca0de15c4a2079988b6e6c266" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>nfs_res_t</type>
        <definition>nfs_res_t nfs_dupreq_get</definition>
        <argsstring>(long xid, int *pstatus)</argsstring>
        <name>nfs_dupreq_get</name>
        <param>
          <type>long</type>
          <declname>xid</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>pstatus</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_dupreq_get: Tries to get a duplicated requests for dupreq cache</para><para>Tries to get a duplicated requests for dupreq cache.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>xid</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] the transfer id we are looking for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pstatus</parametername>
</parameternamelist>
<parameterdescription>
<para>[OUT] the pointer to the status for the operation</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the result previously set if *pstatus == DUPREQ_SUCCESS </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="503" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="502" bodyend="527"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_135d644f1f1b2c333ddc223251d615205" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_dupreq_gc_function</definition>
        <argsstring>(LRU_entry_t *pentry, void *addparam)</argsstring>
        <name>nfs_dupreq_gc_function</name>
        <param>
          <type>LRU_entry_t *</type>
          <declname>pentry</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>addparam</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_dupreq_gc_function: Tests is an entry in dupreq cache is to be set invalid (has expired).</para><para>Tests is an entry in dupreq cache is to be set invalid (has expired).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pentry</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] pointer to the entry to test</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if entry must be set invalid, 0 if not.</para></simplesect>
<simplesect kind="see"><para>LRU_invalidate_by_function </para><para>LRU_gc_invalid </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="544" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="543" bodyend="554"/>
      </memberdef>
      <memberdef kind="function" id="nfs__dupreq_8c_1ade2ed32dcdd7eb6990c8f99f5c81370" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void nfs_dupreq_get_stats</definition>
        <argsstring>(hash_stat_t *phstat)</argsstring>
        <name>nfs_dupreq_get_stats</name>
        <param>
          <type>hash_stat_t *</type>
          <declname>phstat</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_dupreq_get_stats: gets the hash table statistics for the duplicate requests.</para><para>Gets the hash table statistics for the duplicate requests.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>phstat</parametername>
</parameternamelist>
<parameterdescription>
<para>[OUT] pointer to the resulting stats.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>nothing (void function)</para></simplesect>
<simplesect kind="see"><para>HashTable_GetStats </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" line="571" bodyfile="/export/GANESHA/src/MainNFSD/nfs_dupreq.c" bodystart="570" bodyend="573"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>vim:expandtab:shiftwidth=8:tabstop=8:</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>CEA/DAM/DIF<sp/><sp/>(2008)</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>contributeur<sp/>:<sp/>Philippe<sp/>DENIEL<sp/><sp/><sp/>philippe.deniel@cea.fr</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Thomas<sp/>LEIBOVICI<sp/><sp/>thomas.leibovici@cea.fr</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>Ce<sp/>logiciel<sp/>est<sp/>un<sp/>serveur<sp/>implementant<sp/>le<sp/>protocole<sp/>NFS.</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/>Ce<sp/>logiciel<sp/>est<sp/>régi<sp/>par<sp/>la<sp/>licence<sp/>CeCILL<sp/>soumise<sp/>au<sp/>droit<sp/>français<sp/>et</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/>respectant<sp/>les<sp/>principes<sp/>de<sp/>diffusion<sp/>des<sp/>logiciels<sp/>libres.<sp/>Vous<sp/>pouvez</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>utiliser,<sp/>modifier<sp/>et/ou<sp/>redistribuer<sp/>ce<sp/>programme<sp/>sous<sp/>les<sp/>conditions</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>de<sp/>la<sp/>licence<sp/>CeCILL<sp/>telle<sp/>que<sp/>diffusée<sp/>par<sp/>le<sp/>CEA,<sp/>le<sp/>CNRS<sp/>et<sp/>l&apos;INRIA</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>sur<sp/>le<sp/>site<sp/>&quot;http://www.cecill.info&quot;.</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>En<sp/>contrepartie<sp/>de<sp/>l&apos;accessibilité<sp/>au<sp/>code<sp/>source<sp/>et<sp/>des<sp/>droits<sp/>de<sp/>copie,</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>de<sp/>modification<sp/>et<sp/>de<sp/>redistribution<sp/>accordés<sp/>par<sp/>cette<sp/>licence,<sp/>il<sp/>n&apos;est</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/>offert<sp/>aux<sp/>utilisateurs<sp/>qu&apos;une<sp/>garantie<sp/>limitée.<sp/><sp/>Pour<sp/>les<sp/>mêmes<sp/>raisons,</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*<sp/>seule<sp/>une<sp/>responsabilité<sp/>restreinte<sp/>pèse<sp/>sur<sp/>l&apos;auteur<sp/>du<sp/>programme,<sp/><sp/>le</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*<sp/>titulaire<sp/>des<sp/>droits<sp/>patrimoniaux<sp/>et<sp/>les<sp/>concédants<sp/>successifs.</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*<sp/>A<sp/>cet<sp/>égard<sp/><sp/>l&apos;attention<sp/>de<sp/>l&apos;utilisateur<sp/>est<sp/>attirée<sp/>sur<sp/>les<sp/>risques</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/>associés<sp/>au<sp/>chargement,<sp/><sp/>à<sp/>l&apos;utilisation,<sp/><sp/>à<sp/>la<sp/>modification<sp/>et/ou<sp/>au</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/>*<sp/>développement<sp/>et<sp/>à<sp/>la<sp/>reproduction<sp/>du<sp/>logiciel<sp/>par<sp/>l&apos;utilisateur<sp/>étant</highlight></codeline>
<codeline lineno="25"><highlight class="comment"><sp/>*<sp/>donné<sp/>sa<sp/>spécificité<sp/>de<sp/>logiciel<sp/>libre,<sp/>qui<sp/>peut<sp/>le<sp/>rendre<sp/>complexe<sp/>à</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/>*<sp/>manipuler<sp/>et<sp/>qui<sp/>le<sp/>réserve<sp/>donc<sp/>à<sp/>des<sp/>développeurs<sp/>et<sp/>des<sp/>professionnels</highlight></codeline>
<codeline lineno="27"><highlight class="comment"><sp/>*<sp/>avertis<sp/>possédant<sp/><sp/>des<sp/><sp/>connaissances<sp/><sp/>informatiques<sp/>approfondies.<sp/><sp/>Les</highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/>*<sp/>utilisateurs<sp/>sont<sp/>donc<sp/>invités<sp/>à<sp/>charger<sp/><sp/>et<sp/><sp/>tester<sp/><sp/>l&apos;adéquation<sp/><sp/>du</highlight></codeline>
<codeline lineno="29"><highlight class="comment"><sp/>*<sp/>logiciel<sp/>à<sp/>leurs<sp/>besoins<sp/>dans<sp/>des<sp/>conditions<sp/>permettant<sp/>d&apos;assurer<sp/>la</highlight></codeline>
<codeline lineno="30"><highlight class="comment"><sp/>*<sp/>sécurité<sp/>de<sp/>leurs<sp/>systèmes<sp/>et<sp/>ou<sp/>de<sp/>leurs<sp/>données<sp/>et,<sp/>plus<sp/>généralement,</highlight></codeline>
<codeline lineno="31"><highlight class="comment"><sp/>*<sp/>à<sp/>l&apos;utiliser<sp/>et<sp/>l&apos;exploiter<sp/>dans<sp/>les<sp/>mêmes<sp/>conditions<sp/>de<sp/>sécurité.</highlight></codeline>
<codeline lineno="32"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="33"><highlight class="comment"><sp/>*<sp/>Le<sp/>fait<sp/>que<sp/>vous<sp/>puissiez<sp/>accéder<sp/>à<sp/>cet<sp/>en-tête<sp/>signifie<sp/>que<sp/>vous<sp/>avez</highlight></codeline>
<codeline lineno="34"><highlight class="comment"><sp/>*<sp/>pris<sp/>connaissance<sp/>de<sp/>la<sp/>licence<sp/>CeCILL,<sp/>et<sp/>que<sp/>vous<sp/>en<sp/>avez<sp/>accepté<sp/>les</highlight></codeline>
<codeline lineno="35"><highlight class="comment"><sp/>*<sp/>termes.</highlight></codeline>
<codeline lineno="36"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="37"><highlight class="comment"><sp/>*<sp/>---------------------</highlight></codeline>
<codeline lineno="38"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="39"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>CEA/DAM/DIF<sp/>(2005)</highlight></codeline>
<codeline lineno="40"><highlight class="comment"><sp/>*<sp/><sp/>Contributor:<sp/>Philippe<sp/>DENIEL<sp/><sp/>philippe.deniel@cea.fr</highlight></codeline>
<codeline lineno="41"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Thomas<sp/>LEIBOVICI<sp/>thomas.leibovici@cea.fr</highlight></codeline>
<codeline lineno="42"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="43"><highlight class="comment"><sp/>*<sp/>This<sp/>software<sp/>is<sp/>a<sp/>server<sp/>that<sp/>implements<sp/>the<sp/>NFS<sp/>protocol.</highlight></codeline>
<codeline lineno="44"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="45"><highlight class="comment"><sp/>*<sp/>This<sp/>software<sp/>is<sp/>governed<sp/>by<sp/>the<sp/>CeCILL<sp/><sp/>license<sp/>under<sp/>French<sp/>law<sp/>and</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/>*<sp/>abiding<sp/>by<sp/>the<sp/>rules<sp/>of<sp/>distribution<sp/>of<sp/>free<sp/>software.<sp/><sp/>You<sp/>can<sp/><sp/>use,</highlight></codeline>
<codeline lineno="47"><highlight class="comment"><sp/>*<sp/>modify<sp/>and/<sp/>or<sp/>redistribute<sp/>the<sp/>software<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>CeCILL</highlight></codeline>
<codeline lineno="48"><highlight class="comment"><sp/>*<sp/>license<sp/>as<sp/>circulated<sp/>by<sp/>CEA,<sp/>CNRS<sp/>and<sp/>INRIA<sp/>at<sp/>the<sp/>following<sp/>URL</highlight></codeline>
<codeline lineno="49"><highlight class="comment"><sp/>*<sp/>&quot;http://www.cecill.info&quot;.</highlight></codeline>
<codeline lineno="50"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="51"><highlight class="comment"><sp/>*<sp/>As<sp/>a<sp/>counterpart<sp/>to<sp/>the<sp/>access<sp/>to<sp/>the<sp/>source<sp/>code<sp/>and<sp/><sp/>rights<sp/>to<sp/>copy,</highlight></codeline>
<codeline lineno="52"><highlight class="comment"><sp/>*<sp/>modify<sp/>and<sp/>redistribute<sp/>granted<sp/>by<sp/>the<sp/>license,<sp/>users<sp/>are<sp/>provided<sp/>only</highlight></codeline>
<codeline lineno="53"><highlight class="comment"><sp/>*<sp/>with<sp/>a<sp/>limited<sp/>warranty<sp/><sp/>and<sp/>the<sp/>software&apos;s<sp/>author,<sp/><sp/>the<sp/>holder<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="54"><highlight class="comment"><sp/>*<sp/>economic<sp/>rights,<sp/><sp/>and<sp/>the<sp/>successive<sp/>licensors<sp/><sp/>have<sp/>only<sp/><sp/>limited</highlight></codeline>
<codeline lineno="55"><highlight class="comment"><sp/>*<sp/>liability.</highlight></codeline>
<codeline lineno="56"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/>*<sp/>In<sp/>this<sp/>respect,<sp/>the<sp/>user&apos;s<sp/>attention<sp/>is<sp/>drawn<sp/>to<sp/>the<sp/>risks<sp/>associated</highlight></codeline>
<codeline lineno="58"><highlight class="comment"><sp/>*<sp/>with<sp/>loading,<sp/><sp/>using,<sp/><sp/>modifying<sp/>and/or<sp/>developing<sp/>or<sp/>reproducing<sp/>the</highlight></codeline>
<codeline lineno="59"><highlight class="comment"><sp/>*<sp/>software<sp/>by<sp/>the<sp/>user<sp/>in<sp/>light<sp/>of<sp/>its<sp/>specific<sp/>status<sp/>of<sp/>free<sp/>software,</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/>*<sp/>that<sp/>may<sp/>mean<sp/><sp/>that<sp/>it<sp/>is<sp/>complicated<sp/>to<sp/>manipulate,<sp/><sp/>and<sp/><sp/>that<sp/><sp/>also</highlight></codeline>
<codeline lineno="61"><highlight class="comment"><sp/>therefore<sp/>means<sp/><sp/>that<sp/>it<sp/>is<sp/>reserved<sp/>for<sp/>developers<sp/><sp/>and<sp/><sp/>experienced</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/>*<sp/>professionals<sp/>having<sp/>in-depth<sp/>computer<sp/>knowledge.<sp/>Users<sp/>are<sp/>therefore</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/>*<sp/>encouraged<sp/>to<sp/>load<sp/>and<sp/>test<sp/>the<sp/>software&apos;s<sp/>suitability<sp/>as<sp/>regards<sp/>their</highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/>*<sp/>requirements<sp/>in<sp/>conditions<sp/>enabling<sp/>the<sp/>security<sp/>of<sp/>their<sp/>systems<sp/>and/or</highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/>*<sp/>data<sp/>to<sp/>be<sp/>ensured<sp/>and,<sp/><sp/>more<sp/>generally,<sp/>to<sp/>use<sp/>and<sp/>operate<sp/>it<sp/>in<sp/>the</highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/>*<sp/>same<sp/>conditions<sp/>as<sp/>regards<sp/>security.</highlight></codeline>
<codeline lineno="67"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="68"><highlight class="comment"><sp/>*<sp/>The<sp/>fact<sp/>that<sp/>you<sp/>are<sp/>presently<sp/>reading<sp/>this<sp/>means<sp/>that<sp/>you<sp/>have<sp/>had</highlight></codeline>
<codeline lineno="69"><highlight class="comment"><sp/>*<sp/>knowledge<sp/>of<sp/>the<sp/>CeCILL<sp/>license<sp/>and<sp/>that<sp/>you<sp/>accept<sp/>its<sp/>terms.</highlight></codeline>
<codeline lineno="70"><highlight class="comment"><sp/>*<sp/>---------------------------------------</highlight></codeline>
<codeline lineno="71"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="preprocessor">#ifdef<sp/>HAVE_CONFIG_H</highlight></codeline>
<codeline lineno="85"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&quot;config.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="87"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_SOLARIS</highlight></codeline>
<codeline lineno="90"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&quot;solaris_port.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="92"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/types.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ctype.h&gt;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>for<sp/>having<sp/>isalnum<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">/*<sp/>for<sp/>having<sp/>atoi<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;dirent.h&gt;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">/*<sp/>for<sp/>having<sp/>MAXNAMLEN<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;netdb.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;netinet/in.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;arpa/inet.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;pthread.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;fcntl.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/file.h&gt;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>for<sp/>having<sp/>FNDELAY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;pwd.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;grp.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_GSSRPC</highlight></codeline>
<codeline lineno="109"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/rpc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/svc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/pmap_clnt.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="113"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/rpc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/svc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/pmap_clnt.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="117"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;LRU_List.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;HashData.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;HashTable.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;log_functions.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_core.h&quot;</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs23.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs4.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;fsal.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;stuff_alloc.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_tools.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_exports.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_file_handle.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_dupreq.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_parameter_t<sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" kindref="member">nfs_param</ref><sp/>;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_function_desc_t<sp/><ref refid="nfs__dupreq_8c_1d1973964670037b91a33fd6b6e4c40bc" kindref="member">nfs2_func_desc</ref>[]<sp/>;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_function_desc_t<sp/><ref refid="nfs__dupreq_8c_1177ddde86497df151d3b3ff5c876d90a" kindref="member">nfs3_func_desc</ref>[]<sp/>;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_function_desc_t<sp/><ref refid="nfs__dupreq_8c_1de3381a451007489495bf0b92585520f" kindref="member">nfs4_func_desc</ref>[]<sp/>;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_function_desc_t<sp/><ref refid="nfs__dupreq_8c_1331b43564c209696c670c70673d544e1" kindref="member">mnt1_func_desc</ref>[]<sp/>;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_function_desc_t<sp/><ref refid="nfs__dupreq_8c_17bcfef9b974d9b55a0f057d959a13bb8" kindref="member">mnt3_func_desc</ref>[]<sp/>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Structure<sp/>used<sp/>for<sp/>duplicated<sp/>request<sp/>cache<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="nfs__worker__thread_8c_13ada0731d68a5b4aab865acfd3d73290" refkind="member"><highlight class="normal">hash_table_t<sp/>*<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref><sp/>;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="158" refid="nfs__dupreq_8c_1e04d38ace0d9a143801c1625135d4ad7" refkind="member"><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_1e04d38ace0d9a143801c1625135d4ad7" kindref="member">get_rpc_xid</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>svc_req<sp/>*<sp/>reqp)</highlight></codeline>
<codeline lineno="159"><highlight class="normal">{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>RPC<sp/>Xid<sp/>is<sp/>used<sp/>for<sp/>RPC<sp/>Reply<sp/>cache.<sp/>With<sp/>UDP<sp/>connection,<sp/>the<sp/>xid<sp/>is<sp/>in<sp/>an<sp/>opaque<sp/>structure</highlight></codeline>
<codeline lineno="161"><highlight class="comment"><sp/><sp/><sp/>*<sp/>stored<sp/>in<sp/>xprt-&gt;xp_p2,<sp/>but<sp/>with<sp/>TCP<sp/>connection,<sp/>the<sp/>xid<sp/>is<sp/>in<sp/>another<sp/>opaque<sp/>structure<sp/>stored</highlight></codeline>
<codeline lineno="162"><highlight class="comment"><sp/><sp/><sp/>*<sp/>in<sp/>xprt-&gt;xp_p1.<sp/>xp_p2<sp/>and<sp/>xp_p1<sp/>are<sp/>mutually<sp/>exclusive.<sp/>The<sp/>opaque<sp/>structure<sp/>are<sp/>well<sp/>defined<sp/>in</highlight></codeline>
<codeline lineno="163"><highlight class="comment"><sp/><sp/><sp/>*<sp/>ONC<sp/>RPC<sp/>protocol<sp/>definitions,<sp/>and<sp/>used<sp/>internally<sp/>by<sp/>the<sp/>ONC<sp/>layers.<sp/>Since<sp/>I<sp/>need<sp/>to<sp/>know<sp/>the<sp/>xid</highlight></codeline>
<codeline lineno="164"><highlight class="comment"><sp/><sp/><sp/>*<sp/>the<sp/>structures<sp/>are<sp/>defined<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">udp_private2__</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/>{<sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>kept<sp/>in<sp/>xprt-&gt;xp_p2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>up_unused;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>u_long<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>up_xid;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">tcp_conn2__</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/>{<sp/><sp/></highlight><highlight class="comment">/*<sp/>kept<sp/>in<sp/>xprt-&gt;xp_p1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>xprt_stat<sp/>strm_stat;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>u_long<sp/>x_id;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>XDR<sp/>xdrs;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>verf_body[MAX_AUTH_BYTES];</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/>Xid<sp/>;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Map<sp/>the<sp/>xp1<sp/>and<sp/>xp2<sp/>field<sp/>to<sp/>the<sp/>udp<sp/>and<sp/>tcp<sp/>private<sp/>structures<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">tcp_conn2__<sp/>*ptcpxp<sp/>=<sp/><sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">tcp_conn2__<sp/>*)(reqp-&gt;rq_xprt-&gt;xp_p1)<sp/>;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">udp_private2__<sp/>*pudpxp<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">udp_private2__<sp/>*)(reqp-&gt;rq_xprt-&gt;xp_p2)<sp/>;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>request<sp/>is<sp/>either<sp/>UDP<sp/>or<sp/>TCP.<sp/>If<sp/>UDP<sp/>Xid<sp/>is<sp/>null,<sp/>then<sp/>look<sp/>for<sp/>TCP<sp/>xid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>reqp-&gt;rq_xprt-&gt;xp_p2<sp/>!=<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>Xid<sp/>=<sp/>pudpxp-&gt;up_xid<sp/>;<sp/><sp/></highlight><highlight class="comment">/*<sp/>UDP<sp/>XID<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>Xid<sp/>=<sp/>ptcpxp-&gt;x_id<sp/>;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>TCP<sp/>XID<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Xid<sp/>;</highlight></codeline>
<codeline lineno="193"><highlight class="normal">}</highlight><highlight class="comment">/*<sp/>get_rpc_xid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="nfs__dupreq_8c_1f812dda060fd0aa4f965adadb15dd22d" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_1f812dda060fd0aa4f965adadb15dd22d" kindref="member">print_entry_dupreq</ref>(<sp/>LRU_data_t<sp/>data,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*str<sp/>)<sp/></highlight></codeline>
<codeline lineno="209"><highlight class="normal">{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/>strcpy(<sp/>str,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;</highlight></codeline>
<codeline lineno="212"><highlight class="normal">}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="nfs__dupreq_8c_10dd9a264f91e9823e807b34e6994f777" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_10dd9a264f91e9823e807b34e6994f777" kindref="member">clean_entry_dupreq</ref>(<sp/><sp/>LRU_entry_t<sp/>*<sp/>pentry,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>addparam<sp/>)<sp/></highlight></codeline>
<codeline lineno="228"><highlight class="normal">{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>hash_buffer_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffkey<sp/>;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/>nfs_function_desc_t<sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/>dupreq_entry_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>**<sp/>dupreq_pool<sp/>=<sp/>(dupreq_entry_t<sp/>**)addparam<sp/>;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/>dupreq_entry_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/>pdupreq<sp/><sp/><sp/><sp/><sp/>=<sp/>(dupreq_entry_t<sp/>*)(pentry-&gt;buffdata.pdata)<sp/>;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Removing<sp/>entry<sp/>in<sp/>the<sp/>hash<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/>buffkey.pdata<sp/>=<sp/>(caddr_t)pdupreq-&gt;xid<sp/>;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/>buffkey.len<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="239"><highlight class="normal">#ifdef<sp/>_DEBUG_DUPREQ<sp/><sp/></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>Garbagge<sp/>collection<sp/>on<sp/>xid=%u&quot;</highlight><highlight class="normal">,<sp/>pdupreq-&gt;xid<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="242"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/>rc<sp/>=<sp/>HashTable_Del(<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref>,<sp/>&amp;buffkey,<sp/>NULL,<sp/>NULL<sp/>);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>if<sp/>hashtable<sp/>no<sp/>such<sp/>key<sp/>=&gt;<sp/>dupreq<sp/>garbaged<sp/>by<sp/>another<sp/>thread<sp/>*/</highlight><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>rc<sp/>!=<sp/>HASHTABLE_SUCCESS<sp/>&amp;&amp;<sp/>rc<sp/>!=<sp/>HASHTABLE_ERROR_NO_SUCH_KEY<sp/>)</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>Error<sp/>while<sp/>cleaning<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>rc<sp/>==<sp/>HASHTABLE_ERROR_NO_SUCH_KEY<sp/>)</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>don&apos;t<sp/>free<sp/>the<sp/>dupreq<sp/>twice<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Locate<sp/>the<sp/>function<sp/>descriptor<sp/>associated<sp/>with<sp/>this<sp/>cached<sp/>request<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pdupreq-&gt;rq_prog<sp/><sp/>==<sp/><ref refid="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" kindref="member">nfs_param</ref>.core_param.nfs_program<sp/>)</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>pdupreq-&gt;rq_vers<sp/>)</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>NFS_V2:</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_1d1973964670037b91a33fd6b6e4c40bc" kindref="member">nfs2_func_desc</ref>[pdupreq-&gt;rq_proc]<sp/>;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>NFS_V3:</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_1177ddde86497df151d3b3ff5c876d90a" kindref="member">nfs3_func_desc</ref>[pdupreq-&gt;rq_proc]<sp/>;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>NFS_V4:</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_1de3381a451007489495bf0b92585520f" kindref="member">nfs4_func_desc</ref>[pdupreq-&gt;rq_proc]<sp/>;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>should<sp/>never<sp/>go<sp/>there<sp/>(this<sp/>situation<sp/>is<sp/>filtered<sp/>in<sp/>nfs_rpc_getreq)<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>NFS<sp/>Protocol<sp/>version<sp/>%d<sp/>unknown<sp/>in<sp/>dupreq_gc&quot;</highlight><highlight class="normal">,<sp/>pdupreq-&gt;rq_vers<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_1d1973964670037b91a33fd6b6e4c40bc" kindref="member">nfs2_func_desc</ref>[0]<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>free<sp/>function<sp/>for<sp/>PROC_NULL<sp/>does<sp/>nothing<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pdupreq-&gt;rq_prog<sp/>==<sp/><ref refid="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" kindref="member">nfs_param</ref>.core_param.mnt_program<sp/>)</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>pdupreq-&gt;rq_vers<sp/>)</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>MOUNT_V1:</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_1331b43564c209696c670c70673d544e1" kindref="member">mnt1_func_desc</ref>[pdupreq-&gt;rq_proc]<sp/>;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>MOUNT_V3:</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>funcdesc<sp/>=<sp/><ref refid="nfs__dupreq_8c_17bcfef9b974d9b55a0f057d959a13bb8" kindref="member">mnt3_func_desc</ref>[pdupreq-&gt;rq_proc]<sp/>;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>should<sp/>never<sp/>go<sp/>there<sp/>(this<sp/>situation<sp/>is<sp/>filtered<sp/>in<sp/>nfs_rpc_getreq)<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>MOUNT<sp/>Protocol<sp/>version<sp/>%d<sp/>unknown<sp/>in<sp/>dupreq_gc&quot;</highlight><highlight class="normal">,<sp/>pdupreq-&gt;rq_vers<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="comment">/*<sp/>switch(<sp/>ptr_req-&gt;vers<sp/>)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>should<sp/>never<sp/>go<sp/>there<sp/>(this<sp/>situation<sp/>is<sp/>filtered<sp/>in<sp/>nfs_rpc_getreq)<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>protocol<sp/>%d<sp/>is<sp/>not<sp/>managed&quot;</highlight><highlight class="normal">,<sp/>pdupreq-&gt;rq_prog<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Call<sp/>the<sp/>free<sp/>function<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>funcdesc.free_function(<sp/>&amp;(pdupreq-&gt;res_nfs)<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Send<sp/>the<sp/>entry<sp/>back<sp/>to<sp/>the<sp/>pool<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/>RELEASE_PREALLOC(<sp/>pdupreq,<sp/>*dupreq_pool,<sp/>next_alloc<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;</highlight></codeline>
<codeline lineno="307"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>clean_entry_dupreq<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="324" refid="nfs__dupreq_8c_17363cd3531f6119e8a2047a57e51e08f" refkind="member"><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_17363cd3531f6119e8a2047a57e51e08f" kindref="member">dupreq_value_hash_func</ref>(<sp/>hash_parameter_t<sp/>*<sp/>p_hparam,<sp/>hash_buffer_t<sp/>*<sp/>buffclef<sp/>)<sp/></highlight></codeline>
<codeline lineno="325"><highlight class="normal">{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)(buffclef-&gt;pdata)<sp/>%<sp/>p_hparam-&gt;index_size<sp/>;</highlight></codeline>
<codeline lineno="327"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/><sp/>dupreq_value_hash_func<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="345" refid="nfs__dupreq_8c_1cd77080a96d71b76efbdee9178171504" refkind="member"><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_1cd77080a96d71b76efbdee9178171504" kindref="member">dupreq_rbt_hash_func</ref>(<sp/>hash_parameter_t<sp/>*<sp/>p_hparam,<sp/>hash_buffer_t<sp/>*<sp/>buffclef<sp/>)<sp/></highlight></codeline>
<codeline lineno="346"><highlight class="normal">{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>use<sp/>the<sp/>Xid<sp/>as<sp/>the<sp/>rbt<sp/>value<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)(buffclef-&gt;pdata)<sp/>;</highlight></codeline>
<codeline lineno="349"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>dupreq_rbt_hash_func<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="364" refid="nfs__dupreq_8c_11754ccd21821c745e816f32a7a459e24" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><ref refid="nfs__dupreq_8c_11754ccd21821c745e816f32a7a459e24" kindref="member">compare_xid</ref>(<sp/><sp/>hash_buffer_t<sp/>*<sp/>buff1,<sp/>hash_buffer_t<sp/>*<sp/>buff2<sp/>)</highlight></codeline>
<codeline lineno="365"><highlight class="normal">{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>xid1<sp/>=<sp/>(long)(buff1-&gt;pdata)<sp/>;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>xid2<sp/>=<sp/>(long)(buff2-&gt;pdata)<sp/>;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(xid1<sp/>==<sp/>xid2)?0:1<sp/>;</highlight></codeline>
<codeline lineno="369"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>compare_xid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="384" refid="nfs__dupreq_8c_130afd5b6d3dff5d4d7d4767089d59b44" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_130afd5b6d3dff5d4d7d4767089d59b44" kindref="member">display_xid</ref>(<sp/>hash_buffer_t<sp/>*<sp/>pbuff,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<sp/>str<sp/>)<sp/></highlight></codeline>
<codeline lineno="385"><highlight class="normal">{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>xid<sp/><sp/>=<sp/>(long)(pbuff-&gt;pdata)<sp/>;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sprintf(<sp/>str,<sp/></highlight><highlight class="stringliteral">&quot;%lX&quot;</highlight><highlight class="normal">,<sp/>xid<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="389"><highlight class="normal">}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="402" refid="nfs__dupreq_8c_10e0c7a1fda2f7d756dd1b2f8b4f97db6" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_10e0c7a1fda2f7d756dd1b2f8b4f97db6" kindref="member">nfs_Init_dupreq</ref>(<sp/>nfs_rpc_dupreq_parameter_t<sp/>param<sp/>)<sp/></highlight></codeline>
<codeline lineno="403"><highlight class="normal">{<sp/></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref><sp/>=<sp/>HashTable_Init(<sp/>param.hash_param<sp/><sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>Cannot<sp/>init<sp/>the<sp/>duplicate<sp/>request<sp/>hash<sp/>table&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DUPREQ_SUCCESS;</highlight></codeline>
<codeline lineno="411"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_Init_dupreq<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="428" refid="nfs__dupreq_8c_172a8bca40613bd2e5a727a7274ca8e66" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_172a8bca40613bd2e5a727a7274ca8e66" kindref="member">nfs_dupreq_add</ref>(<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xid,<sp/></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>svc_req<sp/><sp/>*<sp/>ptr_req<sp/>,</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nfs_res_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>p_res_nfs,</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LRU_list_t<sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>lru_dupreq,</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dupreq_entry_t<sp/>**<sp/>p_dupreq_pool<sp/>)</highlight></codeline>
<codeline lineno="433"><highlight class="normal">{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>hash_buffer_t<sp/><sp/><sp/><sp/>buffkey<sp/><sp/>;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>hash_buffer_t<sp/><sp/><sp/><sp/>buffdata<sp/>;</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/>dupreq_entry_t<sp/>*<sp/>pdupreq<sp/><sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>LRU_entry_t<sp/><sp/><sp/><sp/>*<sp/>pentry<sp/><sp/><sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/>LRU_status_t<sp/><sp/><sp/><sp/><sp/>lru_status<sp/>;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS</highlight></codeline>
<codeline lineno="441"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>debugging<sp/>memory<sp/>leaks<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/>BuddySetDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;dupreq_entry_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="444"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Entry<sp/>to<sp/>be<sp/>cached<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/>GET_PREALLOC(<sp/>pdupreq,<sp/></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(*p_dupreq_pool),<sp/></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" kindref="member">nfs_param</ref>.worker_param.nb_dupreq_prealloc,<sp/></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dupreq_entry_t,<sp/></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>next_alloc<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pdupreq<sp/>==<sp/>NULL<sp/>)<sp/></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DUPREQ_INSERT_MALLOC_ERROR<sp/>;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS</highlight></codeline>
<codeline lineno="456"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>debugging<sp/>memory<sp/>leaks<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/>BuddySetDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;N/A&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="459"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>I<sp/>have<sp/>to<sp/>keep<sp/>an<sp/>integer<sp/>as<sp/>key,<sp/>I<sp/>wil<sp/>use<sp/>the<sp/>pointer<sp/>buffkey-&gt;pdata<sp/>for<sp/>this,<sp/></highlight></codeline>
<codeline lineno="461"><highlight class="comment"><sp/><sp/><sp/>*<sp/>this<sp/>also<sp/>means<sp/>that<sp/>buffkey-&gt;len<sp/>will<sp/>be<sp/>0<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/>buffkey.pdata<sp/>=<sp/>(caddr_t)xid<sp/>;<sp/></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>buffkey.len<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>I<sp/>build<sp/>the<sp/>data<sp/>with<sp/>the<sp/>request<sp/>pointer<sp/>that<sp/>should<sp/>be<sp/>in<sp/>state<sp/>&apos;IN<sp/>USE&apos;<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/>pdupreq-&gt;xid<sp/>=<sp/>xid<sp/>;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/>pdupreq-&gt;res_nfs<sp/>=<sp/>*p_res_nfs<sp/>;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/>pdupreq-&gt;rq_prog<sp/>=<sp/>ptr_req-&gt;rq_prog<sp/>;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/>pdupreq-&gt;rq_vers<sp/>=<sp/>ptr_req-&gt;rq_vers<sp/>;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/>pdupreq-&gt;rq_proc<sp/>=<sp/>ptr_req-&gt;rq_proc<sp/>;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/>pdupreq-&gt;timestamp<sp/>=<sp/>time(<sp/>NULL<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/>buffdata.pdata<sp/>=<sp/>(caddr_t)pdupreq<sp/>;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/>buffdata.len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>dupreq_entry_t<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>HashTable_Set(<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref>,<sp/>&amp;buffkey,<sp/>&amp;buffdata<sp/>)<sp/>!=<sp/>HASHTABLE_SUCCESS<sp/>)</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DUPREQ_INSERT_MALLOC_ERROR<sp/>;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Add<sp/>it<sp/>to<sp/>lru<sp/>list<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>pentry<sp/>=<sp/>LRU_new_entry(<sp/>lru_dupreq,<sp/>&amp;lru_status<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DUPREQ_INSERT_MALLOC_ERROR<sp/>;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>I<sp/>keep<sp/>track<sp/>of<sp/>the<sp/>xid<sp/>too<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/>pentry-&gt;buffdata.pdata<sp/>=<sp/>(caddr_t)pdupreq<sp/>;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/>pentry-&gt;buffdata.len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>dupreq_entry_t<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DUPREQ_SUCCESS<sp/>;<sp/></highlight></codeline>
<codeline lineno="488"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_dupreq_add<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="502" refid="nfs__dupreq_8c_1f44969aca0de15c4a2079988b6e6c266" refkind="member"><highlight class="normal">nfs_res_t<sp/><ref refid="nfs__dupreq_8c_1f44969aca0de15c4a2079988b6e6c266" kindref="member">nfs_dupreq_get</ref>(<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>xid,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<sp/>pstatus<sp/>)</highlight></codeline>
<codeline lineno="503"><highlight class="normal">{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/>hash_buffer_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffkey<sp/>;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/>hash_buffer_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffval<sp/>;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/>nfs_res_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res_nfs<sp/>;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/>buffkey.pdata<sp/>=<sp/>(caddr_t)xid<sp/>;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/>buffkey.len<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>HashTable_Get(<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref>,<sp/>&amp;buffkey,<sp/>&amp;buffval<sp/>)<sp/>==<sp/>HASHTABLE_SUCCESS<sp/>)</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>reset<sp/>timestamp<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>((dupreq_entry_t<sp/>*)buffval.pdata)-&gt;timestamp<sp/>=<sp/>time(<sp/>NULL<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>pstatus<sp/>=<sp/>DUPREQ_SUCCESS<sp/>;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>res_nfs<sp/>=<sp/>((dupreq_entry_t<sp/>*)buffval.pdata)-&gt;res_nfs<sp/>;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DUPREQ<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="519"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DUPREQ:<sp/>Hit<sp/>in<sp/>the<sp/>dupreq<sp/>cache<sp/>for<sp/>xid=%u&quot;</highlight><highlight class="normal">,<sp/>xid<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="521"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*pstatus<sp/>=<sp/>DUPREQ_NOT_FOUND<sp/>;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res_nfs;</highlight></codeline>
<codeline lineno="527"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_dupreq_get<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="543" refid="nfs__dupreq_8c_135d644f1f1b2c333ddc223251d615205" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_135d644f1f1b2c333ddc223251d615205" kindref="member">nfs_dupreq_gc_function</ref>(<sp/>LRU_entry_t<sp/>*<sp/>pentry,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>addparam<sp/>)</highlight></codeline>
<codeline lineno="544"><highlight class="normal">{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/>dupreq_entry_t<sp/>*<sp/>pdupreq<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/>pdupreq<sp/>=<sp/>(dupreq_entry_t<sp/>*)(pentry-&gt;buffdata.pdata)<sp/>;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>if<sp/>entry<sp/>is<sp/>expired<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>time(<sp/>NULL<sp/>)<sp/>-<sp/><sp/>pdupreq-&gt;timestamp<sp/>&gt;<sp/><ref refid="nfs__dupreq_8c_1eb8fc46586993cf210777049fca03969" kindref="member">nfs_param</ref>.core_param.expiration_dupreq<sp/>)</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>LRU_LIST_SET_INVALID<sp/>;</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>LRU_LIST_DO_NOT_SET_INVALID<sp/>;</highlight></codeline>
<codeline lineno="554"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_dupreq_fc_function<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight></codeline>
<codeline lineno="570" refid="nfs__dupreq_8c_1ade2ed32dcdd7eb6990c8f99f5c81370" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nfs__dupreq_8c_1ade2ed32dcdd7eb6990c8f99f5c81370" kindref="member">nfs_dupreq_get_stats</ref>(<sp/>hash_stat_t<sp/>*<sp/>phstat<sp/>)</highlight></codeline>
<codeline lineno="571"><highlight class="normal">{</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/>HashTable_GetStats(<sp/><ref refid="nfs__dupreq_8c_13ada0731d68a5b4aab865acfd3d73290" kindref="member">ht_dupreq</ref>,<sp/>phstat<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="573"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_dupreq_get_stats<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/export/GANESHA/src/MainNFSD/nfs_dupreq.c"/>
  </compounddef>
</doxygen>

<?xml version='1.0' encoding='iso-8859-1' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.3.9.1">
  <compounddef id="nfs__rpc__dispatcher__thread_8c" kind="file">
    <compoundname>nfs_rpc_dispatcher_thread.c</compoundname>
    <includes local="no">stdio.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">pthread.h</includes>
    <includes local="no">fcntl.h</includes>
    <includes local="no">sys/file.h</includes>
    <includes local="no">gssapi/gssapi.h</includes>
    <includes local="no">sys/select.h</includes>
    <includes local="yes">HashData.h</includes>
    <includes local="yes">HashTable.h</includes>
    <includes local="no">rpc/rpc.h</includes>
    <includes local="no">rpc/svc.h</includes>
    <includes local="no">rpc/pmap_clnt.h</includes>
    <includes local="yes">log_functions.h</includes>
    <includes local="yes">stuff_alloc.h</includes>
    <includes local="yes">nfs23.h</includes>
    <includes local="yes">nfs4.h</includes>
    <includes local="yes">mount.h</includes>
    <includes local="yes">nfs_core.h</includes>
    <includes local="yes">cache_inode.h</includes>
    <includes local="yes">cache_content.h</includes>
    <includes local="yes">nfs_exports.h</includes>
    <includes local="yes">nfs_creds.h</includes>
    <includes local="yes">nfs_proto_functions.h</includes>
    <includes local="yes">nfs_dupreq.h</includes>
    <includes local="yes">nfs_file_handle.h</includes>
    <includes local="yes">nfs_stat.h</includes>
    <includes local="yes">SemN.h</includes>
    <incdepgraph>
      <node id="162">
        <label>sys/select.h</label>
      </node>
      <node id="167">
        <label>rpc/pmap_clnt.h</label>
      </node>
      <node id="172">
        <label>mount.h</label>
      </node>
      <node id="175">
        <label>cache_content.h</label>
      </node>
      <node id="159">
        <label>fcntl.h</label>
      </node>
      <node id="166">
        <label>rpc/svc.h</label>
      </node>
      <node id="168">
        <label>log_functions.h</label>
      </node>
      <node id="171">
        <label>nfs4.h</label>
      </node>
      <node id="158">
        <label>pthread.h</label>
      </node>
      <node id="157">
        <label>string.h</label>
      </node>
      <node id="164">
        <label>HashTable.h</label>
      </node>
      <node id="160">
        <label>sys/file.h</label>
      </node>
      <node id="165">
        <label>rpc/rpc.h</label>
      </node>
      <node id="182">
        <label>SemN.h</label>
      </node>
      <node id="176">
        <label>nfs_exports.h</label>
      </node>
      <node id="173">
        <label>nfs_core.h</label>
      </node>
      <node id="170">
        <label>nfs23.h</label>
      </node>
      <node id="178">
        <label>nfs_proto_functions.h</label>
      </node>
      <node id="169">
        <label>stuff_alloc.h</label>
      </node>
      <node id="155">
        <label>nfs_rpc_dispatcher_thread.c</label>
        <link refid="nfs_rpc_dispatcher_thread.c"/>
        <childnode refid="156" relation="include">
        </childnode>
        <childnode refid="157" relation="include">
        </childnode>
        <childnode refid="158" relation="include">
        </childnode>
        <childnode refid="159" relation="include">
        </childnode>
        <childnode refid="160" relation="include">
        </childnode>
        <childnode refid="161" relation="include">
        </childnode>
        <childnode refid="162" relation="include">
        </childnode>
        <childnode refid="163" relation="include">
        </childnode>
        <childnode refid="164" relation="include">
        </childnode>
        <childnode refid="165" relation="include">
        </childnode>
        <childnode refid="166" relation="include">
        </childnode>
        <childnode refid="167" relation="include">
        </childnode>
        <childnode refid="168" relation="include">
        </childnode>
        <childnode refid="169" relation="include">
        </childnode>
        <childnode refid="170" relation="include">
        </childnode>
        <childnode refid="171" relation="include">
        </childnode>
        <childnode refid="172" relation="include">
        </childnode>
        <childnode refid="173" relation="include">
        </childnode>
        <childnode refid="174" relation="include">
        </childnode>
        <childnode refid="175" relation="include">
        </childnode>
        <childnode refid="176" relation="include">
        </childnode>
        <childnode refid="177" relation="include">
        </childnode>
        <childnode refid="178" relation="include">
        </childnode>
        <childnode refid="179" relation="include">
        </childnode>
        <childnode refid="180" relation="include">
        </childnode>
        <childnode refid="181" relation="include">
        </childnode>
        <childnode refid="182" relation="include">
        </childnode>
      </node>
      <node id="156">
        <label>stdio.h</label>
      </node>
      <node id="174">
        <label>cache_inode.h</label>
      </node>
      <node id="163">
        <label>HashData.h</label>
      </node>
      <node id="180">
        <label>nfs_file_handle.h</label>
      </node>
      <node id="177">
        <label>nfs_creds.h</label>
      </node>
      <node id="181">
        <label>nfs_stat.h</label>
      </node>
      <node id="161">
        <label>gssapi/gssapi.h</label>
      </node>
      <node id="179">
        <label>nfs_dupreq.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structsvc__callout">svc_callout</innerclass>
      <sectiondef kind="define">
      <memberdef kind="define" id="nfs__rpc__dispatcher__thread_8c_1a0" prot="public" static="no">
        <name>NULL_SVC</name>
        <initializer>((struct svc_callout *)0)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="135" bodystart="135" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="nfs__rpc__dispatcher__thread_8c_1a1" prot="public" static="no">
        <name>NO_VALUE_CHOOSEN</name>
        <initializer>1000000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="745"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a14" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>SVCXPRT *</type>
        <definition>SVCXPRT* Svcfd_create</definition>
        <argsstring>(int fd, u_int sendsize, u_int recvsize)</argsstring>
        <name>Svcfd_create</name>
        <param>
          <type>int</type>
          <declname>fd</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>sendsize</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>recvsize</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="128" bodystart="219" bodyend="226"/>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a15" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>SVCXPRT *</type>
        <definition>SVCXPRT* Svctcp_create</definition>
        <argsstring>(register int sock, u_int sendsize, u_int recvsize)</argsstring>
        <name>Svctcp_create</name>
        <param>
          <type>register int</type>
          <declname>sock</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>sendsize</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>recvsize</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="129" bodystart="151" bodyend="212"/>
        <references refid="Svc__tcp__oncrpc_8c_1a0" compoundref="Svc__tcp__oncrpc_8c" startline="29">MAX_CONN</references>
        <references refid="structtcp__rendezvous_1o1" compoundref="Svc__tcp__oncrpc_8c" startline="89">tcp_rendezvous::recvsize</references>
        <references refid="structtcp__rendezvous_1o0" compoundref="Svc__tcp__oncrpc_8c" startline="88">tcp_rendezvous::sendsize</references>
        <references refid="Svc__udp__oncrpc_8c_1a6" compoundref="Svc__gssrpc_8c" startline="98" endline="124">Xprt_register</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a16" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>SVCXPRT *</type>
        <definition>SVCXPRT* Svcudp_bufcreate</definition>
        <argsstring>(register int sock, u_int sendsz, u_int recvsz)</argsstring>
        <name>Svcudp_bufcreate</name>
        <param>
          <type>register int</type>
          <declname>sock</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>sendsz</declname>
        </param>
        <param>
          <type>u_int</type>
          <declname>recvsz</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="130" bodystart="113" bodyend="172"/>
        <references refid="Svc__udp__gssrpc_8c_1a4" compoundref="Svc__udp__gssrpc_8c" startline="66">MAX</references>
        <references refid="Svc__udp__gssrpc_8c_1a3" compoundref="Svc__udp__gssrpc_8c" startline="64">rpc_buffer</references>
        <references refid="structSvcudp__data_1o0" compoundref="Svc__udp__oncrpc_8c" startline="63">Svcudp_data::su_iosz</references>
        <references refid="structSvcudp__data_1o3" compoundref="Svc__udp__oncrpc_8c" startline="66">Svcudp_data::su_verfbody</references>
        <references refid="Svc__udp__oncrpc_8c_1a6" compoundref="Svc__gssrpc_8c" startline="98" endline="124">Xprt_register</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a28" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1231" endline="1250">nfs_Init_request_data</referencedby>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
        <referencedby refid="Svc__udp__gssrpc_8c_1a14" compoundref="Svc__udp__gssrpc_8c" startline="175" endline="179">Svcudp_create</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a17" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool_t</type>
        <definition>bool_t Svc_register</definition>
        <argsstring>(SVCXPRT *xprt, u_long prog, u_long vers, void(*dispatch)(), int protocol)</argsstring>
        <name>Svc_register</name>
        <param>
          <type>SVCXPRT *</type>
          <declname>xprt</declname>
        </param>
        <param>
          <type>u_long</type>
          <declname>prog</declname>
        </param>
        <param>
          <type>u_long</type>
          <declname>vers</declname>
        </param>
        <param>
          <type>void(*)()</type>
          <declname>dispatch</declname>
        </param>
        <param>
          <type>int</type>
          <declname>protocol</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="131" bodystart="107" bodyend="132"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a18" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void socket_setoptions</definition>
        <argsstring>(int socketFd)</argsstring>
        <name>socket_setoptions</name>
        <param>
          <type>int</type>
          <declname>socketFd</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="132" bodystart="245" bodyend="264"/>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a19" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void nfs_rpc_dispatch_dummy</definition>
        <argsstring>(struct svc_req *ptr_req, SVCXPRT *ptr_svc)</argsstring>
        <name>nfs_rpc_dispatch_dummy</name>
        <param>
          <type>struct svc_req *</type>
          <declname>ptr_req</declname>
        </param>
        <param>
          <type>SVCXPRT *</type>
          <declname>ptr_svc</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_rpc_dispatch_dummy: Function never called, but the symbol is necessary for Svc_register/</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ptr_req</parametername>
</parameternamelist>
<parameterdescription>
<para>the RPC request to be managed </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ptr_svc</parametername>
</parameternamelist>
<parameterdescription>
<para>SVCXPRT pointer to be used for managing this request</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>nothing (void function) and is never called indeed. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="323" bodystart="322" bodyend="326"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a20" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_Init_svc</definition>
        <argsstring>()</argsstring>
        <name>nfs_Init_svc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_Init_svc: Init the svc descriptors for the nfs daemon.</para><para>Perform all the required initialization for the SVCXPRT pointer. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="337" bodystart="336" bodyend="736"/>
        <references refid="nfs__dupreq_8c_1a0" compoundref="nfs__init_8c" startline="130">nfs_param</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a19" compoundref="nfs__rpc__dispatcher__thread_8c" startline="322" endline="326">nfs_rpc_dispatch_dummy</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a7">rpcsec_gss_flag</references>
        <references refid="Svc__tcp__oncrpc_8c_1a11" compoundref="nfs__tools_8c" startline="245" endline="264">socket_setoptions</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a2" compoundref="Svc__gssrpc_8c" startline="72">Svc_fdset</references>
        <references refid="Svc__oncrpc_8c_1a10" compoundref="Svc__oncrpc_8c" startline="107" endline="132">Svc_register</references>
        <references refid="Svc__auth__gss_8c_1a23" compoundref="Svc__auth__gss_8c" startline="186" endline="198">Svcauth_gss_acquire_cred</references>
        <references refid="Svc__auth__gss_8c_1a22" compoundref="Svc__auth__gss_8c" startline="163" endline="183">Svcauth_gss_import_name</references>
        <references refid="Svc__tcp__oncrpc_8c_1a25" compoundref="Svc__tcp__oncrpc_8c" startline="120" endline="166">Svctcp_create</references>
        <references refid="Svc__udp__oncrpc_8c_1a15" compoundref="Svc__udp__oncrpc_8c" startline="84" endline="148">Svcudp_bufcreate</references>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a21" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned int</type>
        <definition>unsigned int select_worker_queue</definition>
        <argsstring>()</argsstring>
        <name>select_worker_queue</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Selects the smallest request queue, whome the worker is ready and is not garbagging. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="744" bodystart="743" bodyend="785"/>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a22" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_rpc_get_worker_index</definition>
        <argsstring>(int mount_protocol_flag)</argsstring>
        <name>nfs_rpc_get_worker_index</name>
        <param>
          <type>int</type>
          <declname>mount_protocol_flag</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_rpc_get_worker_index: Returns the index of the worker to be used</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>mount_protocol_flag</parametername>
</parameternamelist>
<parameterdescription>
<para>a flag (TRUE of FALSE) to tell if the worker is to be used for mount protocol</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the chosen worker index. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="797" bodystart="796" bodyend="811"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a23" compoundref="nfs__rpc__dispatcher__thread_8c" startline="826" endline="1060">nfs_rpc_getreq</referencedby>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a23" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void nfs_rpc_getreq</definition>
        <argsstring>(fd_set *readfds, nfs_parameter_t *pnfs_para)</argsstring>
        <name>nfs_rpc_getreq</name>
        <param>
          <type>fd_set *</type>
          <declname>readfds</declname>
        </param>
        <param>
          <type>nfs_parameter_t *</type>
          <declname>pnfs_para</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_rpc_getreq: Do half of the work done by svc_getreqset.</para><para>This function wait for an incoming ONC message by waiting on a &apos;select&apos; statement. Then getting a request it perform the authentication and extracts the RPC message for the related socket. It then find the less busy worker (the one with the shortest pending queue) and put the msg in this queue.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>readfds</parametername>
</parameternamelist>
<parameterdescription>
<para>File Descriptor Set related to the socket used for RPC management.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Nothing (void function), but calls svcerr_* function to notify the client when an error occures. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="827" bodystart="826" bodyend="1060"/>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a29" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1265" endline="1274">constructor_nfs_request_data_t</references>
        <references refid="nfs__dupreq_8c_1a0" compoundref="nfs__init_8c" startline="130">nfs_param</references>
        <references refid="nfs__rpc__tcp__socket__manager__thread_8c_1a12" compoundref="nfs__rpc__dispatcher__thread_8c" startline="796" endline="811">nfs_rpc_get_worker_index</references>
        <references refid="nfs__file__content__flush__thread_8c_1a1" compoundref="nfs__init_8c" startline="132">workers_data</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a5" compoundref="Svc__gssrpc_8c" startline="66">Xports</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a26" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1113" endline="1177">rpc_dispatcher_svc_run</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a24" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int clean_pending_request</definition>
        <argsstring>(LRU_entry_t *pentry, void *addparam)</argsstring>
        <name>clean_pending_request</name>
        <param>
          <type>LRU_entry_t *</type>
          <declname>pentry</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>addparam</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>clean_pending_request: cleans an entry in a nfs request LRU,</para><para>cleans an entry in a nfs request LRU.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pentry</parametername>
</parameternamelist>
<parameterdescription>
<para>[INOUT] entry to be cleaned. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>addparam</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] additional parameter used for cleaning.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if ok, other values mean an error. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1075" bodystart="1074" bodyend="1083"/>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a25" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int print_pending_request</definition>
        <argsstring>(LRU_data_t data, char *str)</argsstring>
        <name>print_pending_request</name>
        <param>
          <type>LRU_data_t</type>
          <declname>data</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>str</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>print_pending_request: prints an entry related to a pending request in the LRU list.</para><para>prints an entry related to a pending request in the LRU list.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>[IN] data stored in a LRU entry to be printed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>str</parametername>
</parameternamelist>
<parameterdescription>
<para>[OUT] string used to store the result.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if ok, other values mean an error. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1098" bodystart="1097" bodyend="1100"/>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a26" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void rpc_dispatcher_svc_run</definition>
        <argsstring>(nfs_parameter_t *pnfs_param)</argsstring>
        <name>rpc_dispatcher_svc_run</name>
        <param>
          <type>nfs_parameter_t *</type>
          <declname>pnfs_param</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_rpc_dispatcher_svc_run: the same as svc_run.</para><para>The same as svc_run.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>none</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>nothing (void function) </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1114" bodystart="1113" bodyend="1177"/>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a23" compoundref="nfs__rpc__dispatcher__thread_8c" startline="826" endline="1060">nfs_rpc_getreq</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a27" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1190" endline="1215">rpc_dispatcher_thread</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a27" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void *</type>
        <definition>void* rpc_dispatcher_thread</definition>
        <argsstring>(void *Arg)</argsstring>
        <name>rpc_dispatcher_thread</name>
        <param>
          <type>void *</type>
          <declname>Arg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>rpc_dispatcher_thread: thread used for RPC dispatching.</para><para>Thead used for RPC dispatching. It gets the requests and then spool it to one of the worker&apos;s LRU. The worker chosen is the one with the smaller load (its LRU is the shorter one).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>IndexArg</parametername>
</parameternamelist>
<parameterdescription>
<para>the index for the worker thread (unused)</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer to the result (but this function will mostly loop forever). </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1191" bodystart="1190" bodyend="1215"/>
        <references refid="nfs__dupreq_8c_1a0" compoundref="nfs__init_8c" startline="130">nfs_param</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a26" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1113" endline="1177">rpc_dispatcher_svc_run</references>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a28" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_Init_request_data</definition>
        <argsstring>(nfs_request_data_t *pdata)</argsstring>
        <name>nfs_Init_request_data</name>
        <param>
          <type>nfs_request_data_t *</type>
          <declname>pdata</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_Init_request_data: Init the data associated with a pending request</para><para>This function is used to init the nfs_request_data for a worker. These data are used by the worker for RPC processing.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>A structure of type nfs_worker_parameter_t with all the necessary information related to a worker </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pdata</parametername>
</parameternamelist>
<parameterdescription>
<para>Pointer to the data to be initialized.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if successfull, -1 otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1232" bodystart="1231" bodyend="1250"/>
        <references refid="nfs__dupreq_8c_1a0" compoundref="nfs__init_8c" startline="130">nfs_param</references>
        <references refid="Svc__udp__oncrpc_8c_1a15" compoundref="Svc__udp__oncrpc_8c" startline="84" endline="148">Svcudp_bufcreate</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a29" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1265" endline="1274">constructor_nfs_request_data_t</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a29" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void constructor_nfs_request_data_t</definition>
        <argsstring>(void *ptr)</argsstring>
        <name>constructor_nfs_request_data_t</name>
        <param>
          <type>void *</type>
          <declname>ptr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>constructor_nfs_request_data_t: Constructor for a nfs_request_data_t structure</para><para>This function is used to init the nfs_request_data for a worker. These data are used by the worker for RPC processing.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ptr</parametername>
</parameternamelist>
<parameterdescription>
<para>void pointer to the structure to be managed</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>nothing (void function) will exit the program if failed. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1266" bodystart="1265" bodyend="1274"/>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a28" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1231" endline="1250">nfs_Init_request_data</references>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a23" compoundref="nfs__rpc__dispatcher__thread_8c" startline="826" endline="1060">nfs_rpc_getreq</referencedby>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
      </memberdef>
      <memberdef kind="function" id="nfs__rpc__dispatcher__thread_8c_1a30" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int nfs_Init_gc_counter</definition>
        <argsstring>(void)</argsstring>
        <name>nfs_Init_gc_counter</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>nfs_Init_gc_counter: Init the worker&apos;s gc counters.</para><para>This functions is used to init a mutex and a counter associated with it, to keep track of the number of worker currently performing the garbagge collection.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>void</parametername>
</parameternamelist>
<parameterdescription>
<para>No parameters</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if successfull, -1 otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="1289" bodystart="1288" bodyend="1301"/>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a13" compoundref="nfs__rpc__dispatcher__thread_8c" startline="160">lock_nb_current_gc_workers</references>
        <references refid="nfs__rpc__dispatcher__thread_8c_1a12" compoundref="nfs__rpc__dispatcher__thread_8c" startline="159">nb_current_gc_workers</references>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a2" prot="public" static="no" volatile="no" mutable="no">
        <type>fd_set</type>
        <definition>fd_set Svc_fdset</definition>
        <argsstring></argsstring>
        <name>Svc_fdset</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="137" bodystart="72" bodyend="-1"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
        <referencedby refid="Svc__udp__oncrpc_8c_1a6" compoundref="Svc__gssrpc_8c" startline="98" endline="124">Xprt_register</referencedby>
        <referencedby refid="Svc__udp__oncrpc_8c_1a7" compoundref="Svc__gssrpc_8c" startline="130" endline="149">Xprt_unregister</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a3" prot="public" static="no" volatile="no" mutable="no">
        <type>nfs_worker_data_t *</type>
        <definition>nfs_worker_data_t* workers_data</definition>
        <argsstring></argsstring>
        <name>workers_data</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="138" bodystart="132" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a4" prot="public" static="no" volatile="no" mutable="no">
        <type>nfs_parameter_t</type>
        <definition>nfs_parameter_t nfs_param</definition>
        <argsstring></argsstring>
        <name>nfs_param</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="139" bodystart="130" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a5" prot="public" static="no" volatile="no" mutable="no">
        <type>SVCXPRT **</type>
        <definition>SVCXPRT** Xports</definition>
        <argsstring></argsstring>
        <name>Xports</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="140" bodystart="66" bodyend="-1"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a23" compoundref="nfs__rpc__dispatcher__thread_8c" startline="826" endline="1060">nfs_rpc_getreq</referencedby>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
        <referencedby refid="Svc__oncrpc_8c_1a13" compoundref="Svc__oncrpc_8c" startline="175" endline="270">Svc_getreqset</referencedby>
        <referencedby refid="Svc__udp__oncrpc_8c_1a6" compoundref="Svc__gssrpc_8c" startline="98" endline="124">Xprt_register</referencedby>
        <referencedby refid="Svc__udp__oncrpc_8c_1a7" compoundref="Svc__gssrpc_8c" startline="130" endline="149">Xprt_unregister</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a6" prot="public" static="no" volatile="no" mutable="no">
        <type>hash_table_t *</type>
        <definition>hash_table_t* ht_dupreq</definition>
        <argsstring></argsstring>
        <name>ht_dupreq</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="144" bodystart="136" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a7" prot="public" static="no" volatile="no" mutable="no">
        <type>int</type>
        <definition>int rpcsec_gss_flag</definition>
        <argsstring></argsstring>
        <name>rpcsec_gss_flag</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="145"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a20" compoundref="nfs__rpc__dispatcher__thread_8c" startline="336" endline="736">nfs_Init_svc</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a8" prot="public" static="no" volatile="no" mutable="no">
        <type>pthread_mutex_t</type>
        <definition>pthread_mutex_t mutex_cond_xprt[FD_SETSIZE]</definition>
        <argsstring>[FD_SETSIZE]</argsstring>
        <name>mutex_cond_xprt</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="147" bodystart="72" bodyend="-1"/>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
        <referencedby refid="nfs__worker__thread_8c_1a20" compoundref="nfs__worker__thread_8c" startline="773" endline="1151">worker_thread</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a9" prot="public" static="no" volatile="no" mutable="no">
        <type>pthread_cond_t</type>
        <definition>pthread_cond_t condvar_xprt[FD_SETSIZE]</definition>
        <argsstring>[FD_SETSIZE]</argsstring>
        <name>condvar_xprt</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="148" bodystart="73" bodyend="-1"/>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
        <referencedby refid="nfs__worker__thread_8c_1a20" compoundref="nfs__worker__thread_8c" startline="773" endline="1151">worker_thread</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a10" prot="public" static="no" volatile="no" mutable="no">
        <type>int</type>
        <definition>int etat_xprt[FD_SETSIZE]</definition>
        <argsstring>[FD_SETSIZE]</argsstring>
        <name>etat_xprt</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="149" bodystart="74" bodyend="-1"/>
        <referencedby refid="Svc__tcp__oncrpc_8c_1a28" compoundref="nfs__rpc__tcp__socket__manager__thread_8c" startline="163" endline="377">rpc_tcp_socket_manager_thread</referencedby>
        <referencedby refid="nfs__worker__thread_8c_1a20" compoundref="nfs__worker__thread_8c" startline="773" endline="1151">worker_thread</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a11" prot="public" static="yes" volatile="no" mutable="no">
        <type>svc_callout *</type>
        <definition>struct svc_callout * svc_head</definition>
        <argsstring></argsstring>
        <name>svc_head</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="157"/>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a12" prot="public" static="no" volatile="no" mutable="no">
        <type>unsigned int</type>
        <definition>unsigned int nb_current_gc_workers</definition>
        <argsstring></argsstring>
        <name>nb_current_gc_workers</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="159" bodystart="159" bodyend="-1"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a30" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1288" endline="1301">nfs_Init_gc_counter</referencedby>
        <referencedby refid="nfs__worker__thread_8c_1a20" compoundref="nfs__worker__thread_8c" startline="773" endline="1151">worker_thread</referencedby>
      </memberdef>
      <memberdef kind="variable" id="nfs__rpc__dispatcher__thread_8c_1a13" prot="public" static="no" volatile="no" mutable="no">
        <type>pthread_mutex_t</type>
        <definition>pthread_mutex_t lock_nb_current_gc_workers</definition>
        <argsstring></argsstring>
        <name>lock_nb_current_gc_workers</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c" line="160" bodystart="160" bodyend="-1"/>
        <referencedby refid="nfs__rpc__dispatcher__thread_8c_1a30" compoundref="nfs__rpc__dispatcher__thread_8c" startline="1288" endline="1301">nfs_Init_gc_counter</referencedby>
        <referencedby refid="nfs__worker__thread_8c_1a20" compoundref="nfs__worker__thread_8c" startline="773" endline="1151">worker_thread</referencedby>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>vim:expandtab:shiftwidth=8:tabstop=8:</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>CEA/DAM/DIF<sp/><sp/>(2008)</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>contributeur<sp/>:<sp/>Philippe<sp/>DENIEL<sp/><sp/><sp/>philippe.deniel@cea.fr</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Thomas<sp/>LEIBOVICI<sp/><sp/>thomas.leibovici@cea.fr</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/>Ce<sp/>logiciel<sp/>est<sp/>un<sp/>serveur<sp/>implementant<sp/>le<sp/>protocole<sp/>NFS.</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/>Ce<sp/>logiciel<sp/>est<sp/>régi<sp/>par<sp/>la<sp/>licence<sp/>CeCILL<sp/>soumise<sp/>au<sp/>droit<sp/>français<sp/>et</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>respectant<sp/>les<sp/>principes<sp/>de<sp/>diffusion<sp/>des<sp/>logiciels<sp/>libres.<sp/>Vous<sp/>pouvez</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>utiliser,<sp/>modifier<sp/>et/ou<sp/>redistribuer<sp/>ce<sp/>programme<sp/>sous<sp/>les<sp/>conditions</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>de<sp/>la<sp/>licence<sp/>CeCILL<sp/>telle<sp/>que<sp/>diffusée<sp/>par<sp/>le<sp/>CEA,<sp/>le<sp/>CNRS<sp/>et<sp/>l&apos;INRIA</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>sur<sp/>le<sp/>site<sp/>&quot;http://www.cecill.info&quot;.</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>En<sp/>contrepartie<sp/>de<sp/>l&apos;accessibilité<sp/>au<sp/>code<sp/>source<sp/>et<sp/>des<sp/>droits<sp/>de<sp/>copie,</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/>de<sp/>modification<sp/>et<sp/>de<sp/>redistribution<sp/>accordés<sp/>par<sp/>cette<sp/>licence,<sp/>il<sp/>n&apos;est</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*<sp/>offert<sp/>aux<sp/>utilisateurs<sp/>qu&apos;une<sp/>garantie<sp/>limitée.<sp/><sp/>Pour<sp/>les<sp/>mêmes<sp/>raisons,</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*<sp/>seule<sp/>une<sp/>responsabilité<sp/>restreinte<sp/>pèse<sp/>sur<sp/>l&apos;auteur<sp/>du<sp/>programme,<sp/><sp/>le</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*<sp/>titulaire<sp/>des<sp/>droits<sp/>patrimoniaux<sp/>et<sp/>les<sp/>concédants<sp/>successifs.</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/>A<sp/>cet<sp/>égard<sp/><sp/>l&apos;attention<sp/>de<sp/>l&apos;utilisateur<sp/>est<sp/>attirée<sp/>sur<sp/>les<sp/>risques</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/>*<sp/>associés<sp/>au<sp/>chargement,<sp/><sp/>à<sp/>l&apos;utilisation,<sp/><sp/>à<sp/>la<sp/>modification<sp/>et/ou<sp/>au</highlight></codeline>
<codeline lineno="25"><highlight class="comment"><sp/>*<sp/>développement<sp/>et<sp/>à<sp/>la<sp/>reproduction<sp/>du<sp/>logiciel<sp/>par<sp/>l&apos;utilisateur<sp/>étant</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/>*<sp/>donné<sp/>sa<sp/>spécificité<sp/>de<sp/>logiciel<sp/>libre,<sp/>qui<sp/>peut<sp/>le<sp/>rendre<sp/>complexe<sp/>à</highlight></codeline>
<codeline lineno="27"><highlight class="comment"><sp/>*<sp/>manipuler<sp/>et<sp/>qui<sp/>le<sp/>réserve<sp/>donc<sp/>à<sp/>des<sp/>développeurs<sp/>et<sp/>des<sp/>professionnels</highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/>*<sp/>avertis<sp/>possédant<sp/><sp/>des<sp/><sp/>connaissances<sp/><sp/>informatiques<sp/>approfondies.<sp/><sp/>Les</highlight></codeline>
<codeline lineno="29"><highlight class="comment"><sp/>*<sp/>utilisateurs<sp/>sont<sp/>donc<sp/>invités<sp/>à<sp/>charger<sp/><sp/>et<sp/><sp/>tester<sp/><sp/>l&apos;adéquation<sp/><sp/>du</highlight></codeline>
<codeline lineno="30"><highlight class="comment"><sp/>*<sp/>logiciel<sp/>à<sp/>leurs<sp/>besoins<sp/>dans<sp/>des<sp/>conditions<sp/>permettant<sp/>d&apos;assurer<sp/>la</highlight></codeline>
<codeline lineno="31"><highlight class="comment"><sp/>*<sp/>sécurité<sp/>de<sp/>leurs<sp/>systèmes<sp/>et<sp/>ou<sp/>de<sp/>leurs<sp/>données<sp/>et,<sp/>plus<sp/>généralement,</highlight></codeline>
<codeline lineno="32"><highlight class="comment"><sp/>*<sp/>à<sp/>l&apos;utiliser<sp/>et<sp/>l&apos;exploiter<sp/>dans<sp/>les<sp/>mêmes<sp/>conditions<sp/>de<sp/>sécurité.</highlight></codeline>
<codeline lineno="33"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="34"><highlight class="comment"><sp/>*<sp/>Le<sp/>fait<sp/>que<sp/>vous<sp/>puissiez<sp/>accéder<sp/>à<sp/>cet<sp/>en-tête<sp/>signifie<sp/>que<sp/>vous<sp/>avez</highlight></codeline>
<codeline lineno="35"><highlight class="comment"><sp/>*<sp/>pris<sp/>connaissance<sp/>de<sp/>la<sp/>licence<sp/>CeCILL,<sp/>et<sp/>que<sp/>vous<sp/>en<sp/>avez<sp/>accepté<sp/>les</highlight></codeline>
<codeline lineno="36"><highlight class="comment"><sp/>*<sp/>termes.</highlight></codeline>
<codeline lineno="37"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="38"><highlight class="comment"><sp/>*<sp/>---------------------</highlight></codeline>
<codeline lineno="39"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="40"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>CEA/DAM/DIF<sp/>(2005)</highlight></codeline>
<codeline lineno="41"><highlight class="comment"><sp/>*<sp/><sp/>Contributor:<sp/>Philippe<sp/>DENIEL<sp/><sp/>philippe.deniel@cea.fr</highlight></codeline>
<codeline lineno="42"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Thomas<sp/>LEIBOVICI<sp/>thomas.leibovici@cea.fr</highlight></codeline>
<codeline lineno="43"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="44"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="45"><highlight class="comment"><sp/>*<sp/>This<sp/>software<sp/>is<sp/>a<sp/>server<sp/>that<sp/>implements<sp/>the<sp/>NFS<sp/>protocol.</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/>*<sp/></highlight></codeline>
<codeline lineno="47"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="48"><highlight class="comment"><sp/>*<sp/>This<sp/>software<sp/>is<sp/>governed<sp/>by<sp/>the<sp/>CeCILL<sp/><sp/>license<sp/>under<sp/>French<sp/>law<sp/>and</highlight></codeline>
<codeline lineno="49"><highlight class="comment"><sp/>*<sp/>abiding<sp/>by<sp/>the<sp/>rules<sp/>of<sp/>distribution<sp/>of<sp/>free<sp/>software.<sp/><sp/>You<sp/>can<sp/><sp/>use,</highlight></codeline>
<codeline lineno="50"><highlight class="comment"><sp/>*<sp/>modify<sp/>and/<sp/>or<sp/>redistribute<sp/>the<sp/>software<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>CeCILL</highlight></codeline>
<codeline lineno="51"><highlight class="comment"><sp/>*<sp/>license<sp/>as<sp/>circulated<sp/>by<sp/>CEA,<sp/>CNRS<sp/>and<sp/>INRIA<sp/>at<sp/>the<sp/>following<sp/>URL</highlight></codeline>
<codeline lineno="52"><highlight class="comment"><sp/>*<sp/>&quot;http://www.cecill.info&quot;.</highlight></codeline>
<codeline lineno="53"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="54"><highlight class="comment"><sp/>*<sp/>As<sp/>a<sp/>counterpart<sp/>to<sp/>the<sp/>access<sp/>to<sp/>the<sp/>source<sp/>code<sp/>and<sp/><sp/>rights<sp/>to<sp/>copy,</highlight></codeline>
<codeline lineno="55"><highlight class="comment"><sp/>*<sp/>modify<sp/>and<sp/>redistribute<sp/>granted<sp/>by<sp/>the<sp/>license,<sp/>users<sp/>are<sp/>provided<sp/>only</highlight></codeline>
<codeline lineno="56"><highlight class="comment"><sp/>*<sp/>with<sp/>a<sp/>limited<sp/>warranty<sp/><sp/>and<sp/>the<sp/>software&apos;s<sp/>author,<sp/><sp/>the<sp/>holder<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/>*<sp/>economic<sp/>rights,<sp/><sp/>and<sp/>the<sp/>successive<sp/>licensors<sp/><sp/>have<sp/>only<sp/><sp/>limited</highlight></codeline>
<codeline lineno="58"><highlight class="comment"><sp/>*<sp/>liability.</highlight></codeline>
<codeline lineno="59"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/>*<sp/>In<sp/>this<sp/>respect,<sp/>the<sp/>user&apos;s<sp/>attention<sp/>is<sp/>drawn<sp/>to<sp/>the<sp/>risks<sp/>associated</highlight></codeline>
<codeline lineno="61"><highlight class="comment"><sp/>*<sp/>with<sp/>loading,<sp/><sp/>using,<sp/><sp/>modifying<sp/>and/or<sp/>developing<sp/>or<sp/>reproducing<sp/>the</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/>*<sp/>software<sp/>by<sp/>the<sp/>user<sp/>in<sp/>light<sp/>of<sp/>its<sp/>specific<sp/>status<sp/>of<sp/>free<sp/>software,</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/>*<sp/>that<sp/>may<sp/>mean<sp/><sp/>that<sp/>it<sp/>is<sp/>complicated<sp/>to<sp/>manipulate,<sp/><sp/>and<sp/><sp/>that<sp/><sp/>also</highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/>therefore<sp/>means<sp/><sp/>that<sp/>it<sp/>is<sp/>reserved<sp/>for<sp/>developers<sp/><sp/>and<sp/><sp/>experienced</highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/>*<sp/>professionals<sp/>having<sp/>in-depth<sp/>computer<sp/>knowledge.<sp/>Users<sp/>are<sp/>therefore</highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/>*<sp/>encouraged<sp/>to<sp/>load<sp/>and<sp/>test<sp/>the<sp/>software&apos;s<sp/>suitability<sp/>as<sp/>regards<sp/>their</highlight></codeline>
<codeline lineno="67"><highlight class="comment"><sp/>*<sp/>requirements<sp/>in<sp/>conditions<sp/>enabling<sp/>the<sp/>security<sp/>of<sp/>their<sp/>systems<sp/>and/or</highlight></codeline>
<codeline lineno="68"><highlight class="comment"><sp/>*<sp/>data<sp/>to<sp/>be<sp/>ensured<sp/>and,<sp/><sp/>more<sp/>generally,<sp/>to<sp/>use<sp/>and<sp/>operate<sp/>it<sp/>in<sp/>the</highlight></codeline>
<codeline lineno="69"><highlight class="comment"><sp/>*<sp/>same<sp/>conditions<sp/>as<sp/>regards<sp/>security.</highlight></codeline>
<codeline lineno="70"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="71"><highlight class="comment"><sp/>*<sp/>The<sp/>fact<sp/>that<sp/>you<sp/>are<sp/>presently<sp/>reading<sp/>this<sp/>means<sp/>that<sp/>you<sp/>have<sp/>had</highlight></codeline>
<codeline lineno="72"><highlight class="comment"><sp/>*<sp/>knowledge<sp/>of<sp/>the<sp/>CeCILL<sp/>license<sp/>and<sp/>that<sp/>you<sp/>accept<sp/>its<sp/>terms.</highlight></codeline>
<codeline lineno="73"><highlight class="comment"><sp/>*<sp/>---------------------------------------</highlight></codeline>
<codeline lineno="74"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="preprocessor">#ifdef<sp/>HAVE_CONFIG_H</highlight></codeline>
<codeline lineno="88"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&quot;config.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="90"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;pthread.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;fcntl.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/file.h&gt;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>for<sp/>having<sp/>FNDELAY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssapi/gssapi.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/select.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;HashData.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;HashTable.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_GSSRPC</highlight></codeline>
<codeline lineno="103"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/rpc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/svc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;gssrpc/pmap_clnt.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="107"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/rpc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/svc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;rpc/pmap_clnt.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="111"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;log_functions.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;stuff_alloc.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs23.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs4.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;mount.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_core.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;cache_inode.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;cache_content.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_exports.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_creds.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_proto_functions.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_dupreq.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_file_handle.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nfs_stat.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;SemN.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal">SVCXPRT<sp/>*<ref refid="Svc__tcp__oncrpc_8c_1a26" kindref="member">Svcfd_create</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd,<sp/>u_int<sp/>sendsize,<sp/>u_int<sp/>recvsize)<sp/>;</highlight></codeline>
<codeline lineno="129"><highlight class="normal">SVCXPRT<sp/>*<sp/><ref refid="Svc__tcp__oncrpc_8c_1a25" kindref="member">Svctcp_create</ref>(</highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/>sock,<sp/>u_int<sp/>sendsize,<sp/>u_int<sp/>recvsize)<sp/>;</highlight></codeline>
<codeline lineno="130"><highlight class="normal">SVCXPRT<sp/>*<sp/><ref refid="Svc__udp__oncrpc_8c_1a15" kindref="member">Svcudp_bufcreate</ref>(</highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sock,<sp/>u_int<sp/>sendsz,<sp/>u_int<sp/>recvsz)<sp/>;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">bool_t<sp/><ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(SVCXPRT<sp/>*<sp/>xprt,<sp/>u_long<sp/><sp/>prog,<sp/>u_long<sp/><sp/>vers,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>(*dispatch)(),<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>protocol)<sp/>;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="Svc__tcp__oncrpc_8c_1a11" kindref="member">socket_setoptions</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>socketFd<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135" refid="nfs__rpc__dispatcher__thread_8c_1a0" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>NULL_SVC<sp/>((struct<sp/>svc_callout<sp/>*)0)</highlight></codeline>
<codeline lineno="136"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>fd_set<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Svc_fdset<sp/>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_worker_data_t<sp/>*<sp/>workers_data<sp/>;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>nfs_parameter_t<sp/><sp/><sp/><sp/><sp/>nfs_param<sp/>;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>SVCXPRT<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>**<sp/>Xports;<sp/></highlight><highlight class="comment">/*<sp/>The<sp/>one<sp/>from<sp/>RPCSEC_GSS<sp/>library<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_RPCSEC_GS_64_INSTALLED</highlight></codeline>
<codeline lineno="142"><highlight class="preprocessor"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsvc__rpc__gss__data" kindref="compound">svc_rpc_gss_data</ref><sp/>**<sp/>TabGssData;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="144"><highlight class="preprocessor"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>hash_table_t<sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>ht_dupreq<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>duplicate<sp/>request<sp/>hash<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rpcsec_gss_flag<sp/>;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>pthread_mutex_t<sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a8" kindref="member">mutex_cond_xprt</ref>[FD_SETSIZE]<sp/>;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>pthread_cond_t<sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a9" kindref="member">condvar_xprt</ref>[FD_SETSIZE]<sp/>;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a10" kindref="member">etat_xprt</ref>[FD_SETSIZE]<sp/>;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">svc_callout<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">svc_callout<sp/>*sc_next;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u_long<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sc_prog;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u_long<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sc_vers;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>void<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(*sc_dispatch)();</highlight></codeline>
<codeline lineno="157"><highlight class="normal">}<sp/>*svc_head;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>These<sp/>two<sp/>variables<sp/>keep<sp/>state<sp/>of<sp/>the<sp/>thread<sp/>that<sp/>gc<sp/>at<sp/>this<sp/>time<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159" refid="nfs__worker__thread_8c_1a6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_current_gc_workers<sp/>;</highlight></codeline>
<codeline lineno="160" refid="nfs__worker__thread_8c_1a7" refkind="member"><highlight class="normal">pthread_mutex_t<sp/>lock_nb_current_gc_workers<sp/>;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS<sp/></highlight></codeline>
<codeline lineno="163"><highlight class="preprocessor"></highlight></codeline>
<codeline lineno="172"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>nfs_debug_debug_label_info()<sp/></highlight></codeline>
<codeline lineno="173"><highlight class="normal">{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>count<sp/>;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>buddy_stats_t<sp/>bstats;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;LRU_entry_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>LRU_entry_t<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_content_entry_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_content_entry_t<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_entry_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_entry_t<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_inode_dir_data_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_dir_data_t<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_inode_fsal_data_t:init&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_fsal_data_t:init<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_inode_fsal_data_t:conversion&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_fsal_data_t:conversion<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;cache_inode_parent_entry_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_parent_entry_t<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="199"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;dupreq_entry_t&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="200"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>dupreq_entry_t<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="201"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="202"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;nfs_ip_name_t&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="203"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>nfs_ip_name_t<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="204"><highlight class="comment"></highlight></codeline>
<codeline lineno="205"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;nfs_request_data_t&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="206"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>nfs_request_data_t<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="207"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="208"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;hash_data_t&quot;<sp/>)<sp/>;<sp/></highlight></codeline>
<codeline lineno="209"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>hash_data_t<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="210"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="211"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;rbt_node_t&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="212"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>rbt_node_t=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="213"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="214"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;cache_inode_dir_entry_t<sp/>in<sp/>nfs_Readdir&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="215"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_dir_entry_t<sp/>in<sp/>nfs_Readdir<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="216"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="217"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;cookie<sp/>array<sp/>in<sp/>nfs_Readdir&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="218"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cookie<sp/>array<sp/>in<sp/>nfs_Readdir<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="219"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="220"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;entry_name_array<sp/>in<sp/>nfs_Readdir&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="221"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>entry_name_array<sp/>in<sp/>nfs_Readdir<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="222"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="223"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RES_READDIR2_OK.entries&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="224"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RES_READDIR2_OK.entries<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="225"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="226"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RES_READDIR3_OK.entries&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="227"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RES_READDIR3_OK.entries<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="228"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="229"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;cache_inode_dir_entry_t<sp/>in<sp/>nfs3_Readdirplus&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="230"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cache_inode_dir_entry_t<sp/>in<sp/>nfs3_Readdirplus<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="231"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="232"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;cookie<sp/>array<sp/>in<sp/>nfs3_Readdirplus&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="233"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>cookie<sp/>array<sp/>in<sp/>nfs3_Readdirplus<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="234"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="235"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;entry_name_array<sp/>in<sp/>nfs3_Readdirplus&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="236"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>entry_name_array<sp/>in<sp/>nfs3_Readdirplus<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="237"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="238"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;READDIRPLUS3res_u.resok.reply.entries&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="239"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>READDIRPLUS3res_u.resok.reply.entries<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="240"><highlight class="comment"></highlight></codeline>
<codeline lineno="241"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;Filehandle<sp/>V3<sp/>in<sp/>nfs3_Readdirplus&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="242"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>Filehandle<sp/>V3<sp/>in<sp/>nfs3_Readdirplus<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;<sp/><sp/></highlight></codeline>
<codeline lineno="243"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="244"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;Filehandle<sp/>V3<sp/>in<sp/>nfs3_mkdir&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="245"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>Filehandle<sp/>V3<sp/>in<sp/>nfs3_mkdir<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;<sp/><sp/></highlight></codeline>
<codeline lineno="246"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="247"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;Filehandle<sp/>V3<sp/>in<sp/>nfs3_Create&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="248"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>Filehandle<sp/>V3<sp/>in<sp/>nfs3_Create<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;<sp/><sp/></highlight></codeline>
<codeline lineno="249"><highlight class="comment"></highlight></codeline>
<codeline lineno="250"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:Auth_gss.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="251"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:Auth_gss.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="252"><highlight class="comment"></highlight></codeline>
<codeline lineno="253"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:Auth_unix.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="254"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:Auth_unix.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="255"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="256"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:Clnt_tcp.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="257"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:Clnt_tcp.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="258"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="259"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:Clnt_udp.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="260"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:Clnt_udp.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;<sp/><sp/></highlight></codeline>
<codeline lineno="261"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="262"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:Rpc_cmsg.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="263"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:Rpc_cmsg.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="264"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="265"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:svc.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="266"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:svc.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="267"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="268"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:svc_auth_gss.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="269"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:svc_auth_gss.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="270"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="271"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:svc_tcp.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="272"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:svc_tcp.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="273"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="274"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;RPCSEC_GSS:svc_udp.c&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="275"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>RPCSEC_GSS:svc_udp.c<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="276"><highlight class="comment"><sp/><sp/></highlight></codeline>
<codeline lineno="277"><highlight class="comment"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/>&quot;struct<sp/>mountbody&quot;<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="278"><highlight class="comment"><sp/><sp/>printf(<sp/>&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>struct<sp/>mountbody<sp/>=<sp/>%d\n&quot;,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="279"><highlight class="comment"><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>BuddyCountDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;N/A&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>COUNT<sp/>BUDDY<sp/>ALLOC<sp/>LABEL<sp/>----<sp/>N/A<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>count<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>BuddyGetStats(<sp/>&amp;bstats<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>TOTAL<sp/>SPACE<sp/>USED<sp/>FOR<sp/>WORKER<sp/>THREAD:<sp/>%12lu<sp/>(on<sp/>%2u<sp/>pages)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)bstats.StdUsedSpace,<sp/>bstats.NbStdUsed<sp/>);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>DisplayMemoryMap();</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;--------------------------------------------------\n&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="293"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_debug_debug_label_info<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>nfs_debug_buddy_info()</highlight></codeline>
<codeline lineno="297"><highlight class="normal">{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/>buddy_stats_t<sp/>bstats;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>BuddyGetStats(<sp/>&amp;bstats<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;-------<sp/>TOTAL<sp/>SPACE<sp/>USED<sp/>FOR<sp/>DISPATCHER<sp/>THREAD:<sp/>%12lu<sp/>(on<sp/>%2u<sp/>pages)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)bstats.StdUsedSpace,<sp/>bstats.NbStdUsed<sp/>);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/>DisplayMemoryMap();</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;--------------------------------------------------\n&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="307"><highlight class="normal">}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="310"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="322" refid="nfs__rpc__dispatcher__thread_8c_1a19" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>(<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>svc_req<sp/>*<sp/>ptr_req<sp/>,<sp/>SVCXPRT<sp/>*<sp/>ptr_svc<sp/>)<sp/><sp/></highlight></codeline>
<codeline lineno="323"><highlight class="normal">{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCH<sp/>DUMMY:<sp/>Possible<sp/>error,<sp/>function<sp/>nfs_rpc_dispatch_dummy<sp/>should<sp/>never<sp/>be<sp/>called&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/>return<sp/>;</highlight></codeline>
<codeline lineno="326"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_rpc_dispatch_dummy<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="336" refid="nfs__rpc__dispatcher__thread_8c_1a20" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a20" kindref="member">nfs_Init_svc</ref>(<sp/>)</highlight></codeline>
<codeline lineno="337"><highlight class="normal">{</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">sockaddr_in<sp/><sp/><sp/><sp/><sp/><sp/>sinaddr_nfs;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">sockaddr_in<sp/><sp/><sp/><sp/><sp/><sp/>sinaddr_mnt;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addr_size;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>one<sp/>=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>OM_uint32<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>maj_stat<sp/>;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/>OM_uint32<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_stat<sp/>;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GssError[1024]<sp/>;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>gss_cred_id_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>test_gss_cred<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>gss_name_t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>imported_name<sp/><sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>FD_ZERO(<sp/>&amp;<ref refid="nfs__rpc__dispatcher__thread_8c_1a2" kindref="member">Svc_fdset</ref><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Allocate<sp/>the<sp/>UDP<sp/>and<sp/>TCP<sp/>structure<sp/>for<sp/>the<sp/>RPC<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp<sp/>=<sp/>socket(<sp/>AF_INET,<sp/>SOCK_DGRAM,<sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/>&lt;<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SOCKET,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>a<sp/>udp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp<sp/>=<sp/>socket(<sp/>AF_INET,<sp/>SOCK_STREAM,<sp/>IPPROTO_TCP)<sp/>)<sp/>&lt;<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SOCKET,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>a<sp/>tcp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp<sp/>=<sp/>socket(<sp/>AF_INET,<sp/>SOCK_DGRAM,<sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/>&lt;<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SOCKET,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>a<sp/>udp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp<sp/>=<sp/>socket(<sp/>AF_INET,<sp/>SOCK_STREAM,<sp/>IPPROTO_TCP)<sp/>)<sp/>&lt;<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SOCKET,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>a<sp/>tcp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Use<sp/>SO_REUSEADDR<sp/>in<sp/>order<sp/>to<sp/>avoid<sp/>wait<sp/>the<sp/>2MSL<sp/>timeout<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>setsockopt(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SOL_SOCKET,<sp/>SO_REUSEADDR,<sp/>&amp;one,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>one<sp/>)<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SETSOCKOPT,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Bad<sp/>udp<sp/>socket<sp/>options&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>setsockopt(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp,</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SOL_SOCKET,<sp/>SO_REUSEADDR,<sp/>&amp;one,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>one<sp/>)<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SETSOCKOPT,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Bad<sp/>tcp<sp/>socket<sp/>options&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><ref refid="Svc__tcp__oncrpc_8c_1a11" kindref="member">socket_setoptions</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp<sp/><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>setsockopt(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp,</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SOL_SOCKET,<sp/>SO_REUSEADDR,<sp/>&amp;one,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>one<sp/>)<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SETSOCKOPT,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Bad<sp/>udp<sp/>socket<sp/>options&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>setsockopt(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp,</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SOL_SOCKET,<sp/>SO_REUSEADDR,<sp/>&amp;one,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>one<sp/>)<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SETSOCKOPT,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Bad<sp/>tcp<sp/>socket<sp/>options&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>prefer<sp/>using<sp/>non-blocking<sp/>socket<sp/>in<sp/>the<sp/>specific<sp/>case<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fcntl(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,<sp/>F_SETFL,<sp/>FNDELAY)<sp/>==<sp/>-1)<sp/></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_FCNTL,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>set<sp/>udp<sp/>socket<sp/>as<sp/>non<sp/>blocking&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fcntl(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp,<sp/>F_SETFL,<sp/>FNDELAY)<sp/>==<sp/>-1)<sp/></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_FCNTL,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>set<sp/>udp<sp/>socket<sp/>as<sp/>non<sp/>blocking&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Some<sp/>log<sp/>that<sp/>can<sp/>be<sp/>useful<sp/>when<sp/>debug<sp/>ONC/RPC<sp/>and<sp/>RPCSEC_GSS<sp/>matter<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Socket<sp/>numbers<sp/>are:<sp/>nfs_udp=%u<sp/><sp/>nfs_tcp=%u<sp/><sp/>mnt_udp=%u<sp/><sp/>mnt_tcp=%u&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,<sp/></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp,</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp,</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp<sp/>)<sp/>;<sp/></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Bind<sp/>the<sp/>udp<sp/>and<sp/>tcp<sp/>socket<sp/>to<sp/>port<sp/>2049/tcp<sp/>and<sp/>2049/udp<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/>memset((</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)<sp/>&amp;sinaddr_nfs,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_nfs<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/>sinaddr_nfs.sin_family<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>AF_INET<sp/>;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/>sinaddr_nfs.sin_addr.s_addr<sp/>=<sp/>INADDR_ANY<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>All<sp/>the<sp/>interfaces<sp/>on<sp/>the<sp/>machine<sp/>are<sp/>used<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>sinaddr_nfs.sin_port<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>htons(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_port<sp/>);</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>It&apos;s<sp/>now<sp/>time<sp/>for<sp/>binding<sp/>the<sp/>sockets<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>bind(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,<sp/></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>sockaddr<sp/>*)<sp/>&amp;sinaddr_nfs,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_nfs<sp/>)<sp/>)<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_BIND,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>bind<sp/>udp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>rc<sp/>=<sp/>bind(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp,<sp/></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>sockaddr<sp/>*)<sp/>&amp;sinaddr_nfs,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_nfs<sp/>)<sp/>)<sp/>)<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_BIND,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>bind<sp/>tcp<sp/>socket<sp/>rc=%d<sp/>errno=%d&quot;</highlight><highlight class="normal">,<sp/>rc,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Bind<sp/>the<sp/>udp<sp/>and<sp/>tcp<sp/>socket<sp/>to<sp/>ephemeral<sp/>port<sp/>for<sp/>mountd<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>memset((</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)<sp/>&amp;sinaddr_mnt,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_mnt<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/>sinaddr_mnt.sin_family<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>AF_INET<sp/>;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/>sinaddr_mnt.sin_addr.s_addr<sp/>=<sp/>INADDR_ANY<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>All<sp/>the<sp/>interfaces<sp/>on<sp/>the<sp/>machine<sp/>are<sp/>used<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/>sinaddr_mnt.sin_port<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>htons(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_port<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>It&apos;s<sp/>now<sp/>time<sp/>for<sp/>binding<sp/>the<sp/>sockets<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>bind(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp,<sp/></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>sockaddr<sp/>*)<sp/>&amp;sinaddr_mnt,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_mnt<sp/>)<sp/>)<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_BIND,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>bind<sp/>udp<sp/>socket&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>rc<sp/>=<sp/>bind(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp,<sp/></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>sockaddr<sp/>*)<sp/>&amp;sinaddr_mnt,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>sinaddr_mnt<sp/>)<sp/>)<sp/>)<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_BIND,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>bind<sp/>tcp<sp/>socket<sp/>rc=%d<sp/>errno=%d&quot;</highlight><highlight class="normal">,<sp/>rc,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Unset<sp/>the<sp/>port<sp/>mapper<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/>pmap_unset(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,<sp/>NFS_V2<sp/>);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/>pmap_unset(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,<sp/>NFS_V3<sp/>);</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/>pmap_unset(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,<sp/>NFS_V4<sp/>);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/>pmap_unset(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,<sp/>MOUNT_V1<sp/>);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/>pmap_unset(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,<sp/>MOUNT_V3<sp/>);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Allocation<sp/>of<sp/>the<sp/>SVCXPRT<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Allocation<sp/>of<sp/>the<sp/>SVCXPRT&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_udp<sp/>=<sp/></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="Svc__udp__oncrpc_8c_1a15" kindref="member">Svcudp_bufcreate</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_SEND_BUFFER_SIZE,<sp/></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_RECV_BUFFER_SIZE<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVCUDP_CREATE,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>NFS/UDP<sp/>SVCXPRT&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/><sp/>;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_tcp<sp/>=</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="Svc__tcp__oncrpc_8c_1a25" kindref="member">Svctcp_create</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp,<sp/></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_SEND_BUFFER_SIZE,<sp/></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_RECV_BUFFER_SIZE<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVCTCP_CREATE,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>NFS/TCP<sp/>SVCXPRT&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/><sp/>;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/><sp/></highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_udp<sp/>=<sp/></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="Svc__udp__oncrpc_8c_1a15" kindref="member">Svcudp_bufcreate</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp,</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_SEND_BUFFER_SIZE,<sp/></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_RECV_BUFFER_SIZE<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVCUDP_CREATE,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>MNT/UDP<sp/>SVCXPRT&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/><sp/>;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_tcp<sp/>=</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="Svc__tcp__oncrpc_8c_1a25" kindref="member">Svctcp_create</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp,<sp/></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_SEND_BUFFER_SIZE,<sp/></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_RECV_BUFFER_SIZE<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVCTCP_CREATE,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>allocate<sp/>MNT/TCP<sp/>SVCXPRT&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/><sp/>;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/><sp/></highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_GSSRPC</highlight></codeline>
<codeline lineno="537"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Acquire<sp/>RPCSEC_GSS<sp/>basis<sp/>if<sp/>needed<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a7" kindref="member">rpcsec_gss_flag</ref><sp/>==<sp/>TRUE<sp/>)</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="Svc__auth__gss_8c_1a22" kindref="member">Svcauth_gss_import_name</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.krb5_param.principal<sp/>)<sp/>!=<sp/>TRUE<sp/>)</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Could<sp/>not<sp/>import<sp/>principal<sp/>name<sp/>%s<sp/>into<sp/>GSSAPI&quot;</highlight><highlight class="normal">,<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.krb5_param.principal<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Successfully<sp/>imported<sp/>principal<sp/>%s<sp/>into<sp/>GSSAPI&quot;</highlight><highlight class="normal">,<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.krb5_param.principal<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Trying<sp/>to<sp/>acquire<sp/>a<sp/>credentials<sp/>for<sp/>checking<sp/>name&apos;s<sp/>validity<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__auth__gss_8c_1a23" kindref="member">Svcauth_gss_acquire_cred</ref>()<sp/>)</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>EXIT:<sp/>Cannot<sp/>acquire<sp/>credentials<sp/>for<sp/>principal<sp/>%s&quot;</highlight><highlight class="normal">,<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.krb5_param.principal<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Principal<sp/>%s<sp/>is<sp/>suitable<sp/>for<sp/>acquiring<sp/>credentials&quot;</highlight><highlight class="normal">,<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.krb5_param.principal<sp/>)<sp/>;<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="comment">/*<sp/>if(<sp/>rpcsec_gss_flag<sp/>==<sp/>TRUE<sp/>)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="563"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Perform<sp/>all<sp/>the<sp/>RPC<sp/>registration,<sp/>for<sp/>UDP<sp/>and<sp/>TCP,<sp/>for<sp/>NFS_V2,<sp/>NFS_V3<sp/>and<sp/>NFS_V4<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registration<sp/>to<sp/>the<sp/>portmapper<sp/>for<sp/>NFS<sp/>and<sp/>MOUNT,<sp/>on<sp/>UDP<sp/>and<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_PROXY<sp/></highlight><highlight class="comment">/*<sp/>only<sp/>NFSv4<sp/>is<sp/>supported<sp/>for<sp/>the<sp/>FSAL_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V2/UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_udp,<sp/></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V2,<sp/></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_UDP<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V2<sp/>on<sp/>UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V3/UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_udp,</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V3,<sp/></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V3<sp/>on<sp/>UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>_USE_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V4/UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_udp,<sp/></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V4,<sp/></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V4<sp/>on<sp/>UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_PROXY</highlight></codeline>
<codeline lineno="609"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="611"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_NO_TCP_REGISTER</highlight></codeline>
<codeline lineno="614"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_PROXY<sp/></highlight><highlight class="comment">/*<sp/>only<sp/>NFSv4<sp/>is<sp/>supported<sp/>for<sp/>the<sp/>FSAL_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V2/TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_tcp,<sp/></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V2,<sp/></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_TCP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V2<sp/>on<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V3/TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_tcp,<sp/></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V3,<sp/></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_TCP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V3<sp/>on<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>_USE_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>NFS<sp/>V4/TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_tcp,<sp/></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nfs_program,</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_V4,<sp/></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_TCP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>NFS<sp/>V4<sp/>on<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_nfs_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_PROXY</highlight></codeline>
<codeline lineno="658"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="660"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="662"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="663"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_PROXY<sp/></highlight></codeline>
<codeline lineno="664"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>MOUNT<sp/>V1/UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_udp,<sp/></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MOUNT_V1,</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>MOUNT<sp/>V1<sp/>on<sp/>UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>MOUNT<sp/>V3/UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_udp,<sp/></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MOUNT_V3,</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_UDP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>MOUNT<sp/>V3<sp/>on<sp/>UDP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>_USE_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_NO_TCP_REGISTER<sp/><sp/></highlight></codeline>
<codeline lineno="693"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_PROXY<sp/><sp/></highlight></codeline>
<codeline lineno="695"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>MOUNT<sp/>V1/TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_tcp,<sp/></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MOUNT_V1,</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_TCP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>MOUNT<sp/>V1<sp/>on<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/>DisplayLogLevel(<sp/>NIV_EVENT,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>MOUNT<sp/>V3/TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!<ref refid="Svc__oncrpc_8c_1a10" kindref="member">Svc_register</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_tcp,<sp/></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.mnt_program,</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MOUNT_V3,</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a19" kindref="member">nfs_rpc_dispatch_dummy</ref>,<sp/></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IPPROTO_TCP<sp/>)<sp/>)<sp/></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVC_REGISTER,<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Cannot<sp/>register<sp/>MOUNT<sp/>V3<sp/>on<sp/>TCP&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="722"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_svc_mnt_ok<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>_USE_PROXY<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>_NO_TCP_REGISTER<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Were<sp/>at<sp/>least<sp/>one<sp/>NFS/MNT<sp/>registration<sp/>ok<sp/>?<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>nb_svc_nfs_ok<sp/>==<sp/>0<sp/>||nb_svc_mnt_ok<sp/>==<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Not<sp/>enough<sp/>registration<sp/>for<sp/>servicing<sp/>clients<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS_DISPATCHER:<sp/>/!\\<sp/>|<sp/>No<sp/>registration<sp/>to<sp/>NFS<sp/>and/or<sp/>MOUNT<sp/>programs<sp/>were<sp/>done...&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1<sp/>;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;</highlight></codeline>
<codeline lineno="736"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_Init_svc<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>select_worker_queue(<sp/>)</highlight></codeline>
<codeline lineno="744"><highlight class="normal">{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>NO_VALUE_CHOOSEN<sp/><sp/>1000000</highlight></codeline>
<codeline lineno="746"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>worker_index<sp/>=<sp/>NO_VALUE_CHOOSEN;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>min_number_pending<sp/>=<sp/>NO_VALUE_CHOOSEN<sp/>;</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>last<sp/>;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cpt<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>chose<sp/>the<sp/>smallest<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(<sp/>i<sp/>=<sp/>(last<sp/>+1)%<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nb_worker<sp/>,<sp/>cpt<sp/>=<sp/>0<sp/>;<sp/>cpt<sp/>&lt;<sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nb_worker<sp/>;<sp/>cpt<sp/>++<sp/>,<sp/>i<sp/>=<sp/>(<sp/>i<sp/>+<sp/>1<sp/>)<sp/>%<sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.core_param.nb_worker<sp/>)<sp/></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Choose<sp/>only<sp/>fully<sp/>initialized<sp/>workers<sp/>and<sp/>that<sp/>does<sp/>not<sp/>gc<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].gc_in_progress<sp/>==<sp/>FALSE<sp/>)</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].is_ready<sp/>==<sp/>TRUE<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].pending_request-&gt;nb_entry<sp/>&lt;<sp/>min_number_pending<sp/>)</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_index<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_number_pending<sp/>=<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].pending_request-&gt;nb_entry;</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#<sp/><sp/><sp/><sp/><sp/>ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="771"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].is_ready<sp/>)</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;worker<sp/>thread<sp/>#%u<sp/>is<sp/>not<sp/>ready&quot;</highlight><highlight class="normal">,<sp/>i<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[i].gc_in_progress<sp/>)</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;worker<sp/>thread<sp/>#%u<sp/>is<sp/>doing<sp/>garbage<sp/>collection&quot;</highlight><highlight class="normal">,<sp/>i<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#<sp/><sp/><sp/><sp/><sp/>endif</highlight></codeline>
<codeline lineno="776"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(<sp/>worker_index<sp/>==<sp/>NO_VALUE_CHOOSEN<sp/>);<sp/><sp/></highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/>last<sp/>=<sp/>worker_index<sp/>;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>worker_index;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="785"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>select_worker_queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="796" refid="nfs__rpc__tcp__socket__manager__thread_8c_1a12" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__tcp__socket__manager__thread_8c_1a12" kindref="member">nfs_rpc_get_worker_index</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mount_protocol_flag<sp/>)</highlight></codeline>
<codeline lineno="797"><highlight class="normal">{</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>worker_index<sp/>=<sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="799"><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_NO_MOUNT_LIST</highlight></codeline>
<codeline lineno="801"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>mount_protocol_flag<sp/>==<sp/>TRUE<sp/>)</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>worker_index<sp/>=<sp/>0<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>worker<sp/>#0<sp/>is<sp/>dedicated<sp/>to<sp/>mount<sp/>protocol<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/>worker_index<sp/>=<sp/>select_worker_queue(<sp/><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="805"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="806"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>choose<sp/>a<sp/>worker<sp/>depending<sp/>on<sp/>its<sp/>queue<sp/>length<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/>worker_index<sp/>=<sp/>select_worker_queue()<sp/>;</highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="809"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>worker_index<sp/>;</highlight></codeline>
<codeline lineno="811"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_rpc_get_worker_index<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="826" refid="nfs__rpc__dispatcher__thread_8c_1a23" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a23" kindref="member">nfs_rpc_getreq</ref>(<sp/>fd_set<sp/>*<sp/>readfds,<sp/>nfs_parameter_t<sp/>*<sp/>pnfs_para<sp/>)</highlight></codeline>
<codeline lineno="827"><highlight class="normal">{</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>xprt_stat<sp/>stat;</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">rpc_msg<sp/>*<sp/>pmsg;</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/>u_long<sp/>low_vers;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/>u_long<sp/>high_vers;</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">svc_req<sp/>*<sp/>preq;</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/>SVCXPRT<sp/>*xprt;</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bit;</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><sp/>mask,<sp/>*maskp;</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">register</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sock;</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<sp/>cred_area<sp/>;</highlight></codeline>
<codeline lineno="838"><highlight class="normal"></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/>LRU_entry_t<sp/>*<sp/>pentry<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/>LRU_status_t<sp/><sp/>status<sp/>;</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/>nfs_request_data_t<sp/>*<sp/>pnfsreq<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>worker_index<sp/>;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mount_flag<sp/>=<sp/>FALSE<sp/><sp/>;</highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>portable<sp/>access<sp/>to<sp/>fds_bits<sp/>field<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/>maskp<sp/>=<sp/>__FDS_BITS(<sp/>readfds<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(sock<sp/>=<sp/>0;<sp/>sock<sp/>&lt;<sp/>FD_SETSIZE;<sp/>sock<sp/>+=<sp/>NFDBITS)</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(mask<sp/>=<sp/>*maskp++;<sp/>bit<sp/>=<sp/>ffs(mask);<sp/>mask<sp/>^=<sp/>(1<sp/>&lt;&lt;<sp/>(bit<sp/>-<sp/>1)))<sp/></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sock<sp/>has<sp/>input<sp/>waiting<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xprt<sp/>=<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a5" kindref="member">Xports</ref>[sock<sp/>+<sp/>bit<sp/>-<sp/>1];</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(xprt<sp/>==<sp/>NULL)</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>But<sp/>do<sp/>we<sp/>control<sp/>sock?<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_CRIT,<sp/></highlight><highlight class="stringliteral">&quot;CRITICAL<sp/>ERROR:<sp/>Incoherency<sp/>found<sp/>in<sp/>Xports<sp/>array&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>A<sp/>few<sp/>thread<sp/>manage<sp/>only<sp/>mount<sp/>protocol,<sp/>check<sp/>for<sp/>this<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp<sp/>==<sp/><sp/>sock<sp/>+<sp/>bit<sp/>-<sp/>1<sp/><sp/>)<sp/>||</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp<sp/>==<sp/><sp/>sock<sp/>+<sp/>bit<sp/>-<sp/>1<sp/><sp/>)<sp/>)<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mount_flag<sp/>=<sp/>TRUE<sp/>;</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mount_flag<sp/>=<sp/>FALSE<sp/>;</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Get<sp/>a<sp/>worker<sp/>to<sp/>do<sp/>the<sp/>job<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>worker_index<sp/>=<sp/><ref refid="nfs__rpc__tcp__socket__manager__thread_8c_1a12" kindref="member">nfs_rpc_get_worker_index</ref>(<sp/>mount_flag<sp/>)<sp/>)<sp/>&lt;<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;CRITICAL<sp/>ERROR:<sp/>Couldn&apos;t<sp/>choose<sp/>a<sp/>worker<sp/>!<sp/>Exiting...&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="874"><highlight class="normal"></highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="876"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Use<sp/>request<sp/>from<sp/>spool<sp/>#%d,<sp/>xprt-&gt;xp_sock=%d&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_index,<sp/>xprt-&gt;xp_sock<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="879"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Get<sp/>a<sp/>pnfsreq<sp/>from<sp/>the<sp/>worker&apos;s<sp/>pool<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS</highlight></codeline>
<codeline lineno="884"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>debugging<sp/>memory<sp/>leaks<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BuddySetDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;nfs_request_data_t&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="887"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GET_PREALLOC_CONSTRUCT(<sp/>pnfsreq,</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool,</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nb_pending_prealloc,</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nfs_request_data_t,</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>next_alloc,</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a29" kindref="member">constructor_nfs_request_data_t</ref><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"></highlight></codeline>
<codeline lineno="895"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS</highlight></codeline>
<codeline lineno="896"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>debugging<sp/>memory<sp/>leaks<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BuddySetDebugLabel(<sp/></highlight><highlight class="stringliteral">&quot;N/A&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="899"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pnfsreq<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_CRIT,<sp/></highlight><highlight class="stringliteral">&quot;CRITICAL<sp/>ERROR:<sp/>empty<sp/>request<sp/>pool<sp/>for<sp/>the<sp/>chosen<sp/>worker<sp/>!<sp/>Exiting...&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>0<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"></highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>up<sp/>pointers<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cred_area<sp/>=<sp/>pnfsreq-&gt;cred_area<sp/>;</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preq<sp/>=<sp/>&amp;(pnfsreq-&gt;req)<sp/>;</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pmsg<sp/>=<sp/>&amp;(pnfsreq-&gt;msg)<sp/>;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pmsg-&gt;rm_call.cb_cred.oa_base<sp/>=<sp/>cred_area<sp/>;</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pmsg-&gt;rm_call.cb_verf.oa_base<sp/>=<sp/>&amp;(cred_area[MAX_AUTH_BYTES]);</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preq-&gt;rq_clntcred<sp/>=<sp/>&amp;(cred_area[2<sp/>*<sp/>MAX_AUTH_BYTES]);</highlight></codeline>
<codeline lineno="916"><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="919"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>UDP<sp/>RPCs<sp/>are<sp/>quite<sp/>simple:<sp/>everything<sp/>comes<sp/>to<sp/>the<sp/>same<sp/>socket,<sp/>so<sp/>several<sp/>SVCXPRT</highlight></codeline>
<codeline lineno="920"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>can<sp/>be<sp/>defined,<sp/>one<sp/>per<sp/>tbuf<sp/>to<sp/>handle<sp/>the<sp/>stuff</highlight></codeline>
<codeline lineno="921"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>TCP<sp/>RPCs<sp/>are<sp/>more<sp/>complex:</highlight></codeline>
<codeline lineno="922"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>a<sp/>unique<sp/>SVCXPRT<sp/>exists<sp/>that<sp/>deals<sp/>with<sp/>initial<sp/>tcp<sp/>rendez<sp/>vous.<sp/>It<sp/>does<sp/>the<sp/>accept</highlight></codeline>
<codeline lineno="923"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>with<sp/>the<sp/>client,<sp/>but<sp/>recv<sp/>no<sp/>message<sp/>from<sp/>the<sp/>client.<sp/>But<sp/>SVC_RECV<sp/>on<sp/>it<sp/>creates</highlight></codeline>
<codeline lineno="924"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>a<sp/>new<sp/>SVCXPRT<sp/>dedicated<sp/>to<sp/>the<sp/>client.<sp/>This<sp/>specific<sp/>SVXPRT<sp/>is<sp/>bound<sp/>on<sp/>TCPSocket</highlight></codeline>
<codeline lineno="925"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="926"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>while<sp/>receiving<sp/>something<sp/>on<sp/>the<sp/>Svc_fdset,<sp/>I<sp/>must<sp/>know<sp/>if<sp/>this<sp/>is<sp/>a<sp/>UDP<sp/>request,</highlight></codeline>
<codeline lineno="927"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>an<sp/>initial<sp/>TCP<sp/>request<sp/>or<sp/>a<sp/>TCP<sp/>socket<sp/>from<sp/>an<sp/>already<sp/>connected<sp/>client.</highlight></codeline>
<codeline lineno="928"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>is<sp/>how<sp/>to<sp/>distinguish<sp/>the<sp/>cases:</highlight></codeline>
<codeline lineno="929"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>UDP<sp/>connections<sp/>are<sp/>bound<sp/>to<sp/>socket<sp/>NFS_UDPSocket</highlight></codeline>
<codeline lineno="930"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>TCP<sp/>initial<sp/>connections<sp/>are<sp/>bound<sp/>to<sp/>socket<sp/>NFS_TCPSocket</highlight></codeline>
<codeline lineno="931"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>all<sp/>the<sp/>other<sp/>cases<sp/>are<sp/>requests<sp/>from<sp/>already<sp/>connected<sp/>TCP<sp/>Clients</highlight></codeline>
<codeline lineno="932"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp<sp/>==<sp/>sock<sp/>+<sp/>bit<sp/>-<sp/>1<sp/><sp/>)</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>is<sp/>a<sp/>regular<sp/>UDP<sp/>connection<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="937"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="938"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>NFS<sp/>UDP<sp/>request&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="940"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;xprt<sp/>=<sp/>pnfsreq-&gt;udp_xprt<sp/>;</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;ipproto<sp/>=<sp/>IPPROTO_UDP<sp/>;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"></highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;status<sp/>=<sp/>SVC_RECV(<sp/>pnfsreq-&gt;xprt,<sp/>&amp;(pnfsreq-&gt;msg)<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_udp<sp/>==<sp/><sp/>sock<sp/>+<sp/>bit<sp/>-<sp/>1<sp/><sp/>)</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="948"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>MOUNT<sp/>UDP<sp/>request&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="950"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;xprt<sp/>=<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_udp<sp/>;</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;ipproto<sp/>=<sp/>IPPROTO_UDP<sp/>;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;status<sp/>=<sp/>SVC_RECV(<sp/>pnfsreq-&gt;xprt,<sp/>&amp;(pnfsreq-&gt;msg)<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_tcp<sp/>==<sp/>sock<sp/>+<sp/>bit<sp/>-1<sp/>)</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/></highlight></codeline>
<codeline lineno="958"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>is<sp/>an<sp/>initial<sp/>tcp<sp/>connection<sp/></highlight></codeline>
<codeline lineno="959"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>There<sp/>is<sp/>no<sp/>RPC<sp/>message,<sp/>this<sp/>is<sp/>only<sp/>a<sp/>TCP<sp/>connect.</highlight></codeline>
<codeline lineno="960"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>In<sp/>this<sp/>case,<sp/>the<sp/>SVC_RECV<sp/>does<sp/>only<sp/>produces<sp/>a<sp/>new<sp/>connected<sp/>socket<sp/>(it<sp/>does</highlight></codeline>
<codeline lineno="961"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>just<sp/>a<sp/>call<sp/>to<sp/>accept<sp/>and<sp/>FD_SET)</highlight></codeline>
<codeline lineno="962"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>there<sp/>is<sp/>no<sp/>need<sp/>of<sp/>worker<sp/>thread<sp/>processing<sp/>to<sp/>be<sp/>done</highlight></codeline>
<codeline lineno="963"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="964"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="965"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;An<sp/>initial<sp/>NFS<sp/>TCP<sp/>request<sp/>from<sp/>a<sp/>new<sp/>client&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="967"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;xprt<sp/>=<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_nfs_tcp<sp/>;</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;ipproto<sp/>=<sp/>IPPROTO_TCP<sp/>;</highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;status<sp/>=<sp/>SVC_RECV(<sp/>pnfsreq-&gt;xprt,<sp/>&amp;(pnfsreq-&gt;msg)<sp/>);</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_mnt_tcp<sp/>==<sp/>sock<sp/>+<sp/>bit<sp/>-1<sp/>)</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="974"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="975"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;An<sp/>initial<sp/>MOUNT<sp/>TCP<sp/>request<sp/>from<sp/>a<sp/>new<sp/>client&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="977"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;xprt<sp/>=<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.xprt_mnt_tcp<sp/>;</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;ipproto<sp/>=<sp/>IPPROTO_TCP<sp/>;</highlight></codeline>
<codeline lineno="979"><highlight class="normal"></highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;status<sp/>=<sp/>SVC_RECV(<sp/>pnfsreq-&gt;xprt,<sp/>&amp;(pnfsreq-&gt;msg)<sp/>);</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>is<sp/>a<sp/>regular<sp/>tcp<sp/>request<sp/>on<sp/>an<sp/>established<sp/>connection,<sp/>should<sp/>be<sp/>handle<sp/>by<sp/>a<sp/>dedicated<sp/>thread<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="985"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="986"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>NFS<sp/>TCP<sp/>request<sp/>from<sp/>an<sp/>already<sp/>connected<sp/>client&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="987"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="988"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;tcp_xprt<sp/>=<sp/>xprt<sp/>;</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;xprt<sp/>=<sp/>pnfsreq-&gt;tcp_xprt<sp/><sp/>;</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;ipproto<sp/>=<sp/>IPPROTO_TCP<sp/>;</highlight></codeline>
<codeline lineno="991"><highlight class="normal"></highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pnfsreq-&gt;status<sp/>=<sp/>SVC_RECV(<sp/>pnfsreq-&gt;xprt,<sp/>&amp;(pnfsreq-&gt;msg)<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="994"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="995"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Status<sp/>for<sp/>SVC_RECV<sp/>on<sp/>socket<sp/>%d<sp/>is<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>sock<sp/>+<sp/>bit<sp/>-1,<sp/>pnfsreq-&gt;status<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="996"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="997"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>status<sp/>is<sp/>ok,<sp/>the<sp/>request<sp/>will<sp/>be<sp/>processed<sp/>by<sp/>the<sp/>related</highlight></codeline>
<codeline lineno="999"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>worker,<sp/>otherwise,<sp/>it<sp/>should<sp/>be<sp/>released<sp/>by<sp/>being<sp/>tagged<sp/>as<sp/>invalid*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!pnfsreq-&gt;status<sp/><sp/>)</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>RPC<sp/>over<sp/>TCP<sp/>specific:<sp/>RPC/UDP&apos;s<sp/>xprt<sp/>know<sp/>only<sp/>one<sp/>state:<sp/>XPRT_IDLE,<sp/>because<sp/>UDP<sp/>is<sp/>mostly</highlight></codeline>
<codeline lineno="1003"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>a<sp/>stateless<sp/>protocol.<sp/>With<sp/>RPC/TCP,<sp/>they<sp/>can<sp/>be<sp/>XPRT_DIED<sp/>especially<sp/>when<sp/>the<sp/>client<sp/>closes</highlight></codeline>
<codeline lineno="1004"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>the<sp/>peer&apos;s<sp/>socket.<sp/>We<sp/>have<sp/>to<sp/>cope<sp/>with<sp/>this<sp/>aspect<sp/>in<sp/>the<sp/>next<sp/>lines<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stat<sp/>=<sp/>SVC_STAT(<sp/>pnfsreq-&gt;xprt<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>stat<sp/>==<sp/>XPRT_DIED<sp/>)</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>client<sp/>disappeared...<sp/>socket=%d&quot;</highlight><highlight class="normal">,<sp/><sp/>pnfsreq-&gt;xprt-&gt;xp_sock<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a5" kindref="member">Xports</ref>[<sp/>pnfsreq-&gt;xprt-&gt;xp_sock<sp/>]<sp/>!=<sp/>NULL<sp/>)<sp/></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SVC_DESTROY(<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a5" kindref="member">Xports</ref>[<sp/>pnfsreq-&gt;xprt-&gt;xp_sock<sp/>]<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RELEASE_PREALLOC(<sp/>pnfsreq,<sp/><sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool,<sp/>next_alloc<sp/>)<sp/>;<sp/></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>stat<sp/>==<sp/>XPRT_MOREREQS<sp/>)</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Client<sp/>on<sp/>socket<sp/>%d<sp/>has<sp/>status<sp/>XPRT_MOREREQS&quot;</highlight><highlight class="normal">,<sp/>pnfsreq-&gt;xprt-&gt;xp_sock<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Release<sp/>the<sp/>entry<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="1024"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCH:<sp/>Invalidating<sp/>entry<sp/>with<sp/>xprt_stat=%d&quot;</highlight><highlight class="normal">,<sp/>stat<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1026"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].passcounter<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>should<sp/>be<sp/>used<sp/>for<sp/>UDP<sp/>requests<sp/>only,<sp/>TCP<sp/>request<sp/>have<sp/>dedicted<sp/>management<sp/>threads<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1032"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Awaking<sp/>thread<sp/>#%d&quot;</highlight><highlight class="normal">,worker_index<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1034"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].mutex_req_condvar<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>pentry<sp/>=<sp/>LRU_new_entry(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].pending_request,<sp/>&amp;status<sp/>)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].mutex_req_condvar<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_MAJOR,<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>while<sp/>inserting<sp/>pending<sp/>request<sp/>to<sp/>Thread<sp/>#%d...<sp/>exiting&quot;</highlight><highlight class="normal">,<sp/>worker_index<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pentry-&gt;buffdata.pdata<sp/>=<sp/>(caddr_t)pnfsreq<sp/>;</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pentry-&gt;buffdata.len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/>*pnfsreq<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"></highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pthread_cond_signal(<sp/>&amp;(<ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].req_condvar)<sp/>)<sp/>==<sp/>-1<sp/>)</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].mutex_req_condvar<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCH:<sp/>Cond<sp/>signal<sp/>failed<sp/>for<sp/>thr#%d<sp/>,<sp/>errno<sp/>=<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>worker_index,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].mutex_req_condvar<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>V(<sp/><ref refid="nfs__file__content__flush__thread_8c_1a1" kindref="member">workers_data</ref>[worker_index].request_pool_mutex<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1060"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_rpc_getreq<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1061"><highlight class="normal"></highlight></codeline>
<codeline lineno="1074" refid="nfs__rpc__dispatcher__thread_8c_1a24" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a24" kindref="member">clean_pending_request</ref>(<sp/>LRU_entry_t<sp/>*<sp/>pentry,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>addparam<sp/>)</highlight></codeline>
<codeline lineno="1075"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/>nfs_request_data_t<sp/>**<sp/>preqnfspool<sp/>=<sp/>(nfs_request_data_t<sp/>**)addparam<sp/>;</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/>nfs_request_data_t<sp/>*<sp/><sp/>preqnfs<sp/><sp/><sp/><sp/><sp/>=<sp/>(nfs_request_data_t<sp/>*)(pentry-&gt;buffdata.pdata)<sp/>;</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"></highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Send<sp/>the<sp/>entry<sp/>back<sp/>to<sp/>the<sp/>pool<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/>RELEASE_PREALLOC(<sp/>preqnfs,<sp/>*preqnfspool,<sp/>next_alloc<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1083"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>clean_pending_request<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"></highlight></codeline>
<codeline lineno="1097" refid="nfs__rpc__dispatcher__thread_8c_1a25" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a25" kindref="member">print_pending_request</ref>(<sp/>LRU_data_t<sp/>data,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*str<sp/>)</highlight></codeline>
<codeline lineno="1098"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>snprintf(<sp/>str,<sp/>LRU_DISPLAY_STRLEN,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>implemented<sp/>for<sp/>now&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1100"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>print_pending_request<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1101"><highlight class="normal"></highlight></codeline>
<codeline lineno="1113" refid="nfs__rpc__dispatcher__thread_8c_1a26" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a26" kindref="member">rpc_dispatcher_svc_run</ref>(<sp/>nfs_parameter_t<sp/>*<sp/>pnfs_param<sp/>)</highlight></codeline>
<codeline lineno="1114"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/>fd_set<sp/>readfdset;</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tablesize<sp/>;</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1119"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1120"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nb_iter_memleaks<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1122"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/>tablesize<sp/>=<sp/>getdtablesize();</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(<sp/>TRUE<sp/>)</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Always<sp/>work<sp/>on<sp/>a<sp/>copy<sp/>of<sp/>Svc_fdset<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>readfdset<sp/>=<sp/>Svc_fdset;</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"></highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Select<sp/>on<sp/>a<sp/>fdset<sp/>build<sp/>with<sp/>all<sp/>socket<sp/>used<sp/>in<sp/>NFS/RPC<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1131"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="1132"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Waiting<sp/>for<sp/>incoming<sp/>RPC<sp/>requests&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1134"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Do<sp/>the<sp/>select<sp/>on<sp/>the<sp/>RPC<sp/>fdset<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>select(<sp/>tablesize,<sp/>&amp;readfdset,<sp/>NULL,<sp/>NULL,<sp/>NULL)<sp/>;</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="1139"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;Waiting<sp/>for<sp/>incoming<sp/>RPC<sp/>requests,<sp/>after<sp/>select<sp/>rc=%d&quot;</highlight><highlight class="normal">,<sp/>rc<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1141"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>rc<sp/>)<sp/></highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>-1:</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>errno<sp/>==<sp/>EBADF<sp/>)</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_SYS,<sp/>ERR_SELECT,<sp/>errno<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0:</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/></highlight></codeline>
<codeline lineno="1153"><highlight class="normal"></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_DISPATCH</highlight></codeline>
<codeline lineno="1156"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLogLevel(<sp/>NIV_FULL_DEBUG,<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>SVC<sp/>RUN:<sp/>request(s)<sp/>received&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1158"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a23" kindref="member">nfs_rpc_getreq</ref>(&amp;readfdset,<sp/>pnfs_param<sp/>);</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>break<sp/>;</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="comment">/*<sp/>switch<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1164"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_DEBUG_MEMLEAKS</highlight></codeline>
<codeline lineno="1165"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>nb_iter_memleaks<sp/>&gt;<sp/>1000<sp/>)</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb_iter_memleaks<sp/>=<sp/>0<sp/><sp/>;</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nfs_debug_buddy_info()<sp/>;</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nb_iter_memleaks<sp/>+=<sp/>1<sp/>;</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1173"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="comment">/*<sp/>while<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1175"><highlight class="normal"></highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/>return<sp/>;</highlight></codeline>
<codeline lineno="1177"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>rpc_dispatcher_svc_run<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1178"><highlight class="normal"></highlight></codeline>
<codeline lineno="1190" refid="nfs__rpc__dispatcher__thread_8c_1a27" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a27" kindref="member">rpc_dispatcher_thread</ref>(<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>Arg<sp/>)</highlight></codeline>
<codeline lineno="1191"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/>nfs_parameter_t<sp/>*<sp/>pnfs_param<sp/>=<sp/>(nfs_parameter_t<sp/>*)Arg<sp/>;</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/>SetNameFunction(<sp/></highlight><highlight class="stringliteral">&quot;dispatch_thr&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1197"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_NO_BUDDY_SYSTEM</highlight></codeline>
<codeline lineno="1198"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Initialisation<sp/>of<sp/>the<sp/>Buddy<sp/>Malloc<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Initialization<sp/>of<sp/>memory<sp/>manager&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(<sp/>rc<sp/>=<sp/>BuddyInit(<sp/>&amp;<ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.buddy_param_worker<sp/>))<sp/>!=<sp/>BUDDY_SUCCESS<sp/>)</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Failed<sp/>init<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Memory<sp/>manager<sp/>could<sp/>not<sp/>be<sp/>initialized,<sp/>exiting...&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1207"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calling<sp/>dispatcher<sp/>main<sp/>loop<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>Entering<sp/>nfs/rpc<sp/>dispatcher&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"></highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>DISPATCHER:<sp/>my<sp/>pthread<sp/>id<sp/>is<sp/>%p&quot;</highlight><highlight class="normal">,<sp/>(caddr_t)pthread_self()<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"></highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a26" kindref="member">rpc_dispatcher_svc_run</ref>(<sp/>pnfs_param<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="1215"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>rpc_dispatcher_thread<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1216"><highlight class="normal"></highlight></codeline>
<codeline lineno="1217"><highlight class="normal"></highlight></codeline>
<codeline lineno="1231" refid="nfs__rpc__dispatcher__thread_8c_1a28" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a28" kindref="member">nfs_Init_request_data</ref>(<sp/><sp/>nfs_request_data_t<sp/>*<sp/>pdata<sp/>)<sp/></highlight></codeline>
<codeline lineno="1232"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/>pdata-&gt;ipproto<sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Init<sp/>the<sp/>SVCXPRT<sp/>for<sp/>the<sp/>tcp<sp/>socket<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>choice<sp/>of<sp/>the<sp/>fd<sp/>to<sp/>be<sp/>used<sp/>here<sp/>doesn&apos;t<sp/>really<sp/>matter,<sp/>this<sp/>fd<sp/>will<sp/>be<sp/>overwrittem<sp/>later<sp/></highlight></codeline>
<codeline lineno="1237"><highlight class="comment"><sp/><sp/><sp/>*<sp/>when<sp/>processing<sp/>the<sp/>request<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/>pdata-&gt;tcp_xprt<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(<sp/>pdata-&gt;udp_xprt<sp/>=<sp/><ref refid="Svc__udp__oncrpc_8c_1a15" kindref="member">Svcudp_bufcreate</ref>(<sp/><ref refid="nfs__dupreq_8c_1a0" kindref="member">nfs_param</ref>.worker_param.nfs_svc_data.socket_nfs_udp,</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NFS_SEND_BUFFER_SIZE,<sp/>NFS_RECV_BUFFER_SIZE)<sp/>)<sp/>==<sp/>NULL<sp/>)</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DisplayErrorLog(<sp/>ERR_RPC,<sp/>ERR_SVCUDP_CREATE,<sp/>0<sp/>);</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"></highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/>pdata-&gt;xprt<sp/>=<sp/>NULL<sp/>;</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1250"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_Init_request_data<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1251"><highlight class="normal"></highlight></codeline>
<codeline lineno="1252"><highlight class="normal"></highlight></codeline>
<codeline lineno="1265" refid="nfs__rpc__dispatcher__thread_8c_1a29" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a29" kindref="member">constructor_nfs_request_data_t</ref>(<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>ptr<sp/>)<sp/></highlight></codeline>
<codeline lineno="1266"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/>nfs_request_data_t<sp/>*<sp/>pdata<sp/>=<sp/>(nfs_request_data_t<sp/>*)ptr<sp/>;</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"></highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a28" kindref="member">nfs_Init_request_data</ref>(<sp/>ptr<sp/>)<sp/>!=<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DisplayLog(<sp/></highlight><highlight class="stringliteral">&quot;NFS<sp/>INIT:<sp/>Error<sp/>while<sp/>initing<sp/>request<sp/>data<sp/>&quot;</highlight><highlight class="normal"><sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(<sp/>1<sp/>)<sp/>;</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1274"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"></highlight></codeline>
<codeline lineno="1288" refid="nfs__rpc__dispatcher__thread_8c_1a30" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a30" kindref="member">nfs_Init_gc_counter</ref>(<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>)</highlight></codeline>
<codeline lineno="1289"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/>pthread_mutexattr_t<sp/>mutexattr<sp/>;</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pthread_mutexattr_init(<sp/>&amp;mutexattr<sp/>)<sp/>!=<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"></highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>pthread_mutex_init(<sp/>&amp;<ref refid="nfs__rpc__dispatcher__thread_8c_1a13" kindref="member">lock_nb_current_gc_workers</ref>,<sp/>&amp;mutexattr<sp/>)<sp/>!=0<sp/>)</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1<sp/>;</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"></highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><ref refid="nfs__rpc__dispatcher__thread_8c_1a12" kindref="member">nb_current_gc_workers</ref><sp/>=<sp/>0<sp/>;</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0<sp/>;<sp/></highlight><highlight class="comment">/*<sp/>Success<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1301"><highlight class="normal">}<sp/></highlight><highlight class="comment">/*<sp/>nfs_Init_gc_counter<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1303"><highlight class="normal"></highlight></codeline>
<codeline lineno="1304"><highlight class="normal"></highlight></codeline>
<codeline lineno="1305"><highlight class="normal"></highlight></codeline>
<codeline lineno="1306"><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/opt/philippe/GANESHA/src/MainNFSD/nfs_rpc_dispatcher_thread.c"/>
  </compounddef>
</doxygen>
